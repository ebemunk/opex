"use strict";angular.module("op",["ngAnimate","ui.bootstrap","throttle"]),angular.module("op").directive("selectOnClick",function(){return{restrict:"A",link:function(e,t){t.on("click",function(){angular.element(".feninput").select()})}}}),angular.module("op").directive("pieceHighlight",function(){return{restrict:"A",link:function(e,t,n){t.on("mouseenter",function(){angular.element("."+n.pieceHighlight).addClass("move-alternative-hovered")}),t.on("mouseleave",function(){angular.element("."+n.pieceHighlight).removeClass("move-alternative-hovered")})}}}),angular.module("op").directive("popup",function(){return{restrict:"A",link:function(e,t,n){t.on("click",function(){window.open(n.popup,"share_popup","height=320, width=640, toolbar=no, menubar=no, scrollbars=no, resizable=no, location=no, directories=no, status=no")})}}}),angular.module("op").controller("boardCtrl",["$scope","$http","Logic","throttle",function(e,t,n,r){e.Logic=n,angular.element(document).ready(function(){$(window).on("resize",r(100,function(){n.resizeBoard()}))}),n.resizeBoard()}]),angular.module("throttle",[]).factory("throttle",["$timeout",function(e){return function(t,n,r,o){var i,a=0;"boolean"!=typeof n&&(o=r,r=n,n=void 0);var s=function(){var s=this,p=+new Date-a,u=arguments,f=function(){a=+new Date,r.apply(s,u)},l=function(){i=void 0};o&&!i&&f(),i&&e.cancel(i),void 0===o&&p>t?f():n!==!0&&(i=e(o?l:f,void 0===o?t-p:t))};return s}}]);var Chess=function(e){function t(){at=new Array(128),st={w:R,b:R},pt=N,ut={w:0,b:0},ft=R,lt=0,ct=1,dt=[],ht={},s(i())}function n(){r(z)}function r(e){var n=e.split(/\s+/),r=n[0],a=0;if(!o(e).valid)return!1;t();for(var p=0;p<r.length;p++){var f=r.charAt(p);if("/"===f)a+=8;else if(A(f))a+=parseInt(f,10);else{var l="a">f?N:L;u({type:f.toLowerCase(),color:l},T(a)),a++}}return pt=n[1],n[2].indexOf("K")>-1&&(ut.w|=V.KSIDE_CASTLE),n[2].indexOf("Q")>-1&&(ut.w|=V.QSIDE_CASTLE),n[2].indexOf("k")>-1&&(ut.b|=V.KSIDE_CASTLE),n[2].indexOf("q")>-1&&(ut.b|=V.QSIDE_CASTLE),ft="-"===n[3]?R:ot[n[3]],lt=parseInt(n[4],10),ct=parseInt(n[5],10),s(i()),!0}function o(e){var t={0:"No errors.",1:"FEN string must contain six space-delimited fields.",2:"6th field (move number) must be a positive integer.",3:"5th field (half move counter) must be a non-negative integer.",4:"4th field (en-passant square) is invalid.",5:"3rd field (castling availability) is invalid.",6:"2nd field (side to move) is invalid.",7:"1st field (piece positions) does not contain 8 '/'-delimited rows.",8:"1st field (piece positions) is invalid [consecutive numbers].",9:"1st field (piece positions) is invalid [invalid piece].",10:"1st field (piece positions) is invalid [row too large]."},n=e.split(/\s+/);if(6!==n.length)return{valid:!1,error_number:1,error:t[1]};if(isNaN(n[5])||parseInt(n[5],10)<=0)return{valid:!1,error_number:2,error:t[2]};if(isNaN(n[4])||parseInt(n[4],10)<0)return{valid:!1,error_number:3,error:t[3]};if(!/^(-|[abcdefgh][36])$/.test(n[3]))return{valid:!1,error_number:4,error:t[4]};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(n[2]))return{valid:!1,error_number:5,error:t[5]};if(!/^(w|b)$/.test(n[1]))return{valid:!1,error_number:6,error:t[6]};var r=n[0].split("/");if(8!==r.length)return{valid:!1,error_number:7,error:t[7]};for(var o=0;o<r.length;o++){for(var i=0,a=!1,s=0;s<r[o].length;s++)if(isNaN(r[o][s])){if(!/^[prnbqkPRNBQK]$/.test(r[o][s]))return{valid:!1,error_number:9,error:t[9]};i+=1,a=!1}else{if(a)return{valid:!1,error_number:8,error:t[8]};i+=parseInt(r[o][s],10),a=!0}if(8!==i)return{valid:!1,error_number:10,error:t[10]}}return{valid:!0,error_number:0,error:t[0]}}function i(){for(var e=0,t="",n=ot.a8;n<=ot.h1;n++){if(null==at[n])e++;else{e>0&&(t+=e,e=0);var r=at[n].color,o=at[n].type;t+=r===N?o.toUpperCase():o.toLowerCase()}n+1&136&&(e>0&&(t+=e),n!==ot.h1&&(t+="/"),e=0,n+=8)}var i="";ut[N]&V.KSIDE_CASTLE&&(i+="K"),ut[N]&V.QSIDE_CASTLE&&(i+="Q"),ut[L]&V.KSIDE_CASTLE&&(i+="k"),ut[L]&V.QSIDE_CASTLE&&(i+="q"),i=i||"-";var a=ft===R?"-":T(ft);return[t,pt,i,a,lt,ct].join(" ")}function a(e){for(var t=0;t<e.length;t+=2)"string"==typeof e[t]&&"string"==typeof e[t+1]&&(ht[e[t]]=e[t+1]);return ht}function s(e){dt.length>0||(e!==z?(ht.SetUp="1",ht.FEN=e):(delete ht.SetUp,delete ht.FEN))}function p(e){var t=at[ot[e]];return t?{type:t.type,color:t.color}:null}function u(e,t){if(!("type"in e&&"color"in e))return!1;if(-1===H.indexOf(e.type.toLowerCase()))return!1;if(!(t in ot))return!1;var n=ot[t];return e.type==j&&st[e.color]!=R&&st[e.color]!=n?!1:(at[n]={type:e.type,color:e.color},e.type===j&&(st[e.color]=n),s(i()),!0)}function f(e){var t=p(e);return at[ot[e]]=null,t&&t.type===j&&(st[t.color]=R),s(i()),t}function l(e,t,n,r,o){var i={color:pt,from:t,to:n,flags:r,piece:e[t].type};return o&&(i.flags|=V.PROMOTION,i.promotion=o),e[n]?i.captured=e[n].type:r&V.EP_CAPTURE&&(i.captured=B),i}function c(e){function t(e,t,n,r,o){if(e[n].type!==B||C(r)!==rt&&C(r)!==et)t.push(l(e,n,r,o));else for(var i=[M,Q,K,U],a=0,s=i.length;s>a;a++)t.push(l(e,n,r,o,i[a]))}var n=[],r=pt,o=k(r),i={b:nt,w:tt},a=ot.a8,s=ot.h1,p=!1,u="undefined"!=typeof e&&"legal"in e?e.legal:!0;if("undefined"!=typeof e&&"square"in e){if(!(e.square in ot))return[];a=s=ot[e.square],p=!0}for(var f=a;s>=f;f++)if(136&f)f+=7;else{var c=at[f];if(null!=c&&c.color===r)if(c.type===B){var d=f+X[r][0];if(null==at[d]){t(at,n,f,d,V.NORMAL);var d=f+X[r][1];i[r]===C(f)&&null==at[d]&&t(at,n,f,d,V.BIG_PAWN)}for(g=2;4>g;g++){var d=f+X[r][g];136&d||(null!=at[d]&&at[d].color===o?t(at,n,f,d,V.CAPTURE):d===ft&&t(at,n,f,ft,V.EP_CAPTURE))}}else for(var g=0,m=Y[c.type].length;m>g;g++)for(var b=Y[c.type][g],d=f;;){if(d+=b,136&d)break;if(null!=at[d]){if(at[d].color===r)break;t(at,n,f,d,V.CAPTURE);break}if(t(at,n,f,d,V.NORMAL),"n"===c.type||"k"===c.type)break}}if(!p||s===st[r]){if(ut[r]&V.KSIDE_CASTLE){var w=st[r],y=w+2;null!=at[w+1]||null!=at[y]||h(o,st[r])||h(o,w+1)||h(o,y)||t(at,n,st[r],y,V.KSIDE_CASTLE)}if(ut[r]&V.QSIDE_CASTLE){var w=st[r],y=w-2;null!=at[w-1]||null!=at[w-2]||null!=at[w-3]||h(o,st[r])||h(o,w-1)||h(o,y)||t(at,n,st[r],y,V.QSIDE_CASTLE)}}if(!u)return n;for(var E=[],f=0,m=n.length;m>f;f++)P(n[f]),v(r)||E.push(n[f]),S();return E}function d(e){var t="";if(e.flags&V.KSIDE_CASTLE)t="O-O";else if(e.flags&V.QSIDE_CASTLE)t="O-O-O";else{var n=O(e);e.piece!==B&&(t+=e.piece.toUpperCase()+n),e.flags&(V.CAPTURE|V.EP_CAPTURE)&&(e.piece===B&&(t+=T(e.from)[0]),t+="x"),t+=T(e.to),e.flags&V.PROMOTION&&(t+="="+e.promotion.toUpperCase())}return P(e),g()&&(t+=m()?"#":"+"),S(),t}function h(e,t){for(var n=ot.a8;n<=ot.h1;n++)if(136&n)n+=7;else if(null!=at[n]&&at[n].color===e){var r=at[n],o=n-t,i=o+119;if(J[i]&1<<F[r.type]){if(r.type===B){if(o>0){if(r.color===N)return!0}else if(r.color===L)return!0;continue}if("n"===r.type||"k"===r.type)return!0;for(var a=G[i],s=n+a,p=!1;s!==t;){if(null!=at[s]){p=!0;break}s+=a}if(!p)return!0}}return!1}function v(e){return h(k(e),st[e])}function g(){return v(pt)}function m(){return g()&&0===c().length}function b(){return!g()&&0===c().length}function w(){for(var e={},t=[],n=0,r=0,o=ot.a8;o<=ot.h1;o++)if(r=(r+1)%2,136&o)o+=7;else{var i=at[o];i&&(e[i.type]=i.type in e?e[i.type]+1:1,i.type===K&&t.push(r),n++)}if(2===n)return!0;if(3===n&&(1===e[K]||1===e[U]))return!0;if(n===e[K]+2){for(var a=0,s=t.length,o=0;s>o;o++)a+=t[o];if(0===a||a===s)return!0}return!1}function y(){for(var e=[],t={},n=!1;;){var r=S();if(!r)break;e.push(r)}for(;;){var o=i().split(" ").slice(0,4).join(" ");if(t[o]=o in t?t[o]+1:1,t[o]>=3&&(n=!0),!e.length)break;P(e.pop())}return n}function E(e){dt.push({move:e,kings:{b:st.b,w:st.w},turn:pt,castling:{b:ut.b,w:ut.w},ep_square:ft,half_moves:lt,move_number:ct})}function P(e){var t=pt,n=k(t);if(E(e),at[e.to]=at[e.from],at[e.from]=null,e.flags&V.EP_CAPTURE&&(pt===L?at[e.to-16]=null:at[e.to+16]=null),e.flags&V.PROMOTION&&(at[e.to]={type:e.promotion,color:t}),at[e.to].type===j){if(st[at[e.to].color]=e.to,e.flags&V.KSIDE_CASTLE){var r=e.to-1,o=e.to+1;at[r]=at[o],at[o]=null}else if(e.flags&V.QSIDE_CASTLE){var r=e.to+1,o=e.to-2;at[r]=at[o],at[o]=null}ut[t]=""}if(ut[t])for(var i=0,a=it[t].length;a>i;i++)if(e.from===it[t][i].square&&ut[t]&it[t][i].flag){ut[t]^=it[t][i].flag;break}if(ut[n])for(var i=0,a=it[n].length;a>i;i++)if(e.to===it[n][i].square&&ut[n]&it[n][i].flag){ut[n]^=it[n][i].flag;break}ft=e.flags&V.BIG_PAWN?"b"===pt?e.to-16:e.to+16:R,e.piece===B?lt=0:e.flags&(V.CAPTURE|V.EP_CAPTURE)?lt=0:lt++,pt===L&&ct++,pt=k(pt)}function S(){var e=dt.pop();if(null==e)return null;var t=e.move;st=e.kings,pt=e.turn,ut=e.castling,ft=e.ep_square,lt=e.half_moves,ct=e.move_number;var n=pt,r=k(pt);if(at[t.from]=at[t.to],at[t.from].type=t.piece,at[t.to]=null,t.flags&V.CAPTURE)at[t.to]={type:t.captured,color:r};else if(t.flags&V.EP_CAPTURE){var o;o=n===L?t.to-16:t.to+16,at[o]={type:B,color:r}}if(t.flags&(V.KSIDE_CASTLE|V.QSIDE_CASTLE)){var i,a;t.flags&V.KSIDE_CASTLE?(i=t.to+1,a=t.to-1):t.flags&V.QSIDE_CASTLE&&(i=t.to-2,a=t.to+1),at[i]=at[a],at[a]=null}return t}function O(e){for(var t=c(),n=e.from,r=e.to,o=e.piece,i=0,a=0,s=0,p=0,u=t.length;u>p;p++){var f=t[p].from,l=t[p].to,d=t[p].piece;o===d&&n!==f&&r===l&&(i++,C(n)===C(f)&&a++,_(n)===_(f)&&s++)}return i>0?a>0&&s>0?T(n):T(n).charAt(s>0?1:0):""}function $(){for(var e="   +------------------------+\n",t=ot.a8;t<=ot.h1;t++){if(0===_(t)&&(e+=" "+"87654321"[C(t)]+" |"),null==at[t])e+=" . ";else{var n=at[t].type,r=at[t].color,o=r===N?n.toUpperCase():n.toLowerCase();e+=" "+o+" "}t+1&136&&(e+="|\n",t+=8)}return e+="   +------------------------+\n",e+="     a  b  c  d  e  f  g  h\n"}function C(e){return e>>4}function _(e){return 15&e}function T(e){var t=_(e),n=C(e);return"abcdefgh".substring(t,t+1)+"87654321".substring(n,n+1)}function k(e){return e===N?L:N}function A(e){return-1!=="0123456789".indexOf(e)}function x(e){var t=I(e);t.san=d(t),t.to=T(t.to),t.from=T(t.from);var n="";for(var r in V)V[r]&t.flags&&(n+=Z[r]);return t.flags=n,t}function I(e){var t=e instanceof Array?[]:{};for(var n in e)t[n]="object"==typeof n?I(e[n]):e[n];return t}function q(e){return e.replace(/^\s+|\s+$/g,"")}function D(e){for(var t=c({legal:!1}),n=0,r=pt,o=0,i=t.length;i>o;o++){if(P(t[o]),!v(r))if(e-1>0){var a=D(e-1);n+=a}else n++;S()}return n}var L="b",N="w",R=-1,B="p",U="n",K="b",Q="r",M="q",j="k",H="pnbrqkPNBRQK",z="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",W=["1-0","0-1","1/2-1/2","*"],X={b:[16,32,17,15],w:[-16,-32,-17,-15]},Y={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},J=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],G=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],F={p:0,n:1,b:2,r:3,q:4,k:5},Z={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},V={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},et=7,tt=6,nt=1,rt=0,ot={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},it={w:[{square:ot.a1,flag:V.QSIDE_CASTLE},{square:ot.h1,flag:V.KSIDE_CASTLE}],b:[{square:ot.a8,flag:V.QSIDE_CASTLE},{square:ot.h8,flag:V.KSIDE_CASTLE}]},at=new Array(128),st={w:R,b:R},pt=N,ut={w:0,b:0},ft=R,lt=0,ct=1,dt=[],ht={};return r("undefined"==typeof e?z:e),{WHITE:N,BLACK:L,PAWN:B,KNIGHT:U,BISHOP:K,ROOK:Q,QUEEN:M,KING:j,SQUARES:function(){for(var e=[],t=ot.a8;t<=ot.h1;t++)136&t?t+=7:e.push(T(t));return e}(),FLAGS:Z,load:function(e){return r(e)},reset:function(){return n()},moves:function(e){for(var t=c(e),n=[],r=0,o=t.length;o>r;r++)n.push("undefined"!=typeof e&&"verbose"in e&&e.verbose?x(t[r]):d(t[r]));return n},in_check:function(){return g()},in_checkmate:function(){return m()},in_stalemate:function(){return b()},in_draw:function(){return lt>=100||b()||w()||y()},insufficient_material:function(){return w()},in_threefold_repetition:function(){return y()},game_over:function(){return lt>=100||m()||b()||w()||y()},validate_fen:function(e){return o(e)},fen:function(){return i()},pgn:function(e){var t="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\n",n="object"==typeof e&&"number"==typeof e.max_width?e.max_width:0,r=[],o=!1;for(var i in ht)r.push("["+i+' "'+ht[i]+'"]'+t),o=!0;o&&dt.length&&r.push(t);for(var a=[];dt.length>0;)a.push(S());for(var s=[],p="",u=1;a.length>0;){var f=a.pop();1===u&&"b"===f.color?(p="1. ...",u++):"w"===f.color&&(p.length&&s.push(p),p=u+".",u++),p=p+" "+d(f),P(f)}if(p.length&&s.push(p),"undefined"!=typeof ht.Result&&s.push(ht.Result),0===n)return r.join("")+s.join(" ");for(var l=0,i=0;i<s.length;i++)l+s[i].length>n&&0!==i?(" "===r[r.length-1]&&r.pop(),r.push(t),l=0):0!==i&&(r.push(" "),l++),r.push(s[i]),l+=s[i].length;return r.join("")},load_pgn:function(e,t){function r(e){return e.replace(/\\/g,"\\")}function o(e){for(var t=c(),n=0,r=t.length;r>n;n++)if(e.replace(/[+#?!=]+$/,"")==d(t[n]).replace(/[+#?!=]+$/,""))return t[n];return null}function i(e){return o(q(e))}function s(e){var t=!1;for(var n in e)t=!0;return t}function p(e,t){for(var n="object"==typeof t&&"string"==typeof t.newline_char?t.newline_char:"\r?\n",o={},i=e.split(new RegExp(r(n))),a="",s="",p=0;p<i.length;p++)a=i[p].replace(/^\[([A-Z][A-Za-z]*)\s.*\]$/,"$1"),s=i[p].replace(/^\[[A-Za-z]+\s"(.*)"\]$/,"$1"),q(a).length>0&&(o[a]=s);return o}var u="object"==typeof t&&"string"==typeof t.newline_char?t.newline_char:"\r?\n",f=new RegExp("^(\\[(.|"+r(u)+")*\\])("+r(u)+")*1.("+r(u)+"|.)*$","g"),l=e.replace(f,"$1");"["!==l[0]&&(l=""),n();var h=p(l,t);for(var v in h)a([v,h[v]]);var g=e.replace(l,"").replace(new RegExp(r(u),"g")," ");g=g.replace(/(\{[^}]+\})+?/g,""),g=g.replace(/\d+\./g,"");var m=q(g).split(new RegExp(/\s+/));m=m.join(",").replace(/,,+/g,",").split(",");for(var b="",w=0;w<m.length-1;w++){if(b=i(m[w]),null==b)return!1;P(b)}if(b=m[m.length-1],W.indexOf(b)>-1)s(ht)&&"undefined"==typeof ht.Result&&a(["Result",b]);else{if(b=i(b),null==b)return!1;P(b)}return!0},header:function(){return a(arguments)},ascii:function(){return $()},turn:function(){return pt},move:function(e){var t=null,n=c();if("string"==typeof e){for(var r=0,o=n.length;o>r;r++)if(e===d(n[r])){t=n[r];break}}else if("object"==typeof e)for(var r=0,o=n.length;o>r;r++)if(!(e.from!==T(n[r].from)||e.to!==T(n[r].to)||"promotion"in n[r]&&e.promotion!==n[r].promotion)){t=n[r];break}if(!t)return null;var i=x(t);return P(t),i},undo:function(){var e=S();return e?x(e):null},clear:function(){return t()},put:function(e,t){return u(e,t)},get:function(e){return p(e)},remove:function(e){return f(e)},perft:function(e){return D(e)},square_color:function(e){if(e in ot){var t=ot[e];return(C(t)+_(t))%2===0?"light":"dark"}return null},history:function(e){for(var t=[],n=[],r=("undefined"!=typeof e&&"verbose"in e&&e.verbose);dt.length>0;)t.push(S());for(;t.length>0;){var o=t.pop();n.push(r?x(o):d(o)),P(o)}return n}}};"undefined"!=typeof exports&&(exports.Chess=Chess),"undefined"!=typeof define&&define(function(){return Chess}),function(){function e(e){if("string"!=typeof e)return!1;var n=e.split("-");return 2!==n.length?!1:t(n[0])===!0&&t(n[1])===!0}function t(e){return"string"!=typeof e?!1:-1!==e.search(/^[a-h][1-8]$/)}function n(e){return"string"!=typeof e?!1:-1!==e.search(/^[bw][KQRNBP]$/)}function r(e){if("string"!=typeof e)return!1;e=e.replace(/ .+$/,"");var t=e.split("/");if(8!==t.length)return!1;for(var n=0;8>n;n++)if(""===t[n]||t[n].length>8||-1!==t[n].search(/[^kqrbnpKQRNBP1-8]/))return!1;return!0}function o(e){if("object"!=typeof e)return!1;for(var r in e)if(e.hasOwnProperty(r)===!0&&(t(r)!==!0||n(e[r])!==!0))return!1;return!0}function i(e){return e.toLowerCase()===e?"b"+e.toUpperCase():"w"+e.toUpperCase()}function a(e){var t=e.split("");return"w"===t[0]?t[1].toUpperCase():t[1].toLowerCase()}function s(e){if(r(e)!==!0)return!1;e=e.replace(/ .+$/,"");for(var t=e.split("/"),n={},o=8,a=0;8>a;a++){for(var s=t[a].split(""),p=0,f=0;f<s.length;f++)if(-1!==s[f].search(/[1-8]/)){var l=parseInt(s[f],10);p+=l}else{var c=u[p]+o;n[c]=i(s[f]),p++}o--}return n}function p(e){if(o(e)!==!0)return!1;for(var t="",n=8,r=0;8>r;r++){for(var i=0;8>i;i++){var s=u[i]+n;t+=e.hasOwnProperty(s)===!0?a(e[s]):"1"}7!==r&&(t+="/"),n--}return t=t.replace(/11111111/g,"8"),t=t.replace(/1111111/g,"7"),t=t.replace(/111111/g,"6"),t=t.replace(/11111/g,"5"),t=t.replace(/1111/g,"4"),t=t.replace(/111/g,"3"),t=t.replace(/11/g,"2")}var u="abcdefgh".split("");window.ChessBoard=window.ChessBoard||function(n,i){function a(){return"xxxx-xxxx-xxxx-xxxx-xxxx-xxxx-xxxx-xxxx".replace(/x/g,function(){var e=16*Math.random()|0;return e.toString(16)})}function f(e){return JSON.parse(JSON.stringify(e))}function l(e){var t=e.split(".");return{major:parseInt(t[0],10),minor:parseInt(t[1],10),patch:parseInt(t[2],10)}}function c(e,t){e=l(e),t=l(t);var n=1e4*e.major*1e4+1e4*e.minor+e.patch,r=1e4*t.major*1e4+1e4*t.minor+t.patch;return n>=r}function d(e,t,n){if(i.hasOwnProperty("showErrors")===!0&&i.showErrors!==!1){var r="ChessBoard Error "+e+": "+t;return"console"===i.showErrors&&"object"==typeof console&&"function"==typeof console.log?(console.log(r),void(arguments.length>=2&&console.log(n))):"alert"===i.showErrors?(n&&(r+="\n\n"+JSON.stringify(n)),void window.alert(r)):void("function"==typeof i.showErrors&&i.showErrors(e,t,n))}}function h(){if("string"==typeof n){if(""===n)return window.alert("ChessBoard Error 1001: The first argument to ChessBoard() cannot be an empty string.\n\nExiting..."),!1;var e=document.getElementById(n);if(!e)return window.alert('ChessBoard Error 1002: Element with id "'+n+'" does not exist in the DOM.\n\nExiting...'),!1;st=$(e)}else if(st=$(n),1!==st.length)return window.alert("ChessBoard Error 1003: The first argument to ChessBoard() must be an ID or a single DOM node.\n\nExiting..."),!1;return window.JSON&&"function"==typeof JSON.stringify&&"function"==typeof JSON.parse?$.fn&&$.fn.jquery&&c($.fn.jquery,mt)===!0?!0:(window.alert("ChessBoard Error 1005: Unable to find a valid version of jQuery. Please include jQuery "+mt+" or higher on the page.\n\nExiting..."),!1):(window.alert("ChessBoard Error 1004: JSON does not exist. Please include a JSON polyfill.\n\nExiting..."),!1)}function v(e){return"fast"===e||"slow"===e?!0:parseInt(e,10)+""!=e+""?!1:e>=0}function g(){return("string"==typeof i||o(i)===!0)&&(i={position:i}),"black"!==i.orientation&&(i.orientation="white"),Ot=i.orientation,i.showNotation!==!1&&(i.showNotation=!0),i.draggable!==!0&&(i.draggable=!1),"trash"!==i.dropOffBoard&&(i.dropOffBoard="snapback"),i.sparePieces!==!0&&(i.sparePieces=!1),i.sparePieces===!0&&(i.draggable=!0),(i.hasOwnProperty("pieceTheme")!==!0||"string"!=typeof i.pieceTheme&&"function"!=typeof i.pieceTheme)&&(i.pieceTheme="img/chesspieces/wikipedia/{piece}.png"),(i.hasOwnProperty("appearSpeed")!==!0||v(i.appearSpeed)!==!0)&&(i.appearSpeed=200),(i.hasOwnProperty("moveSpeed")!==!0||v(i.moveSpeed)!==!0)&&(i.moveSpeed=200),(i.hasOwnProperty("snapbackSpeed")!==!0||v(i.snapbackSpeed)!==!0)&&(i.snapbackSpeed=50),(i.hasOwnProperty("snapSpeed")!==!0||v(i.snapSpeed)!==!0)&&(i.snapSpeed=25),(i.hasOwnProperty("trashSpeed")!==!0||v(i.trashSpeed)!==!0)&&(i.trashSpeed=100),i.hasOwnProperty("position")===!0&&("start"===i.position?$t=f(wt):r(i.position)===!0?$t=s(i.position):o(i.position)===!0?$t=f(i.position):d(7263,"Invalid value passed to config.position.",i.position)),!0}function m(){var e=parseInt(st.css("width"),10);if(!e||0>=e)return 0;for(var t=e-1;t%8!==0&&t>0;)t--;return t/8}function b(){for(var e=0;e<u.length;e++)for(var t=1;8>=t;t++){var n=u[e]+t;Tt[n]=n+"-"+a()}for(var r="KQRBNP".split(""),e=0;e<r.length;e++){var o="w"+r[e],i="b"+r[e];_t[o]=o+"-"+a(),_t[i]=i+"-"+a()}}function w(){var e='<div class="'+yt.chessboard+'">';return i.sparePieces===!0&&(e+='<div class="'+yt.sparePieces+" "+yt.sparePiecesTop+'"></div>'),e+='<div class="'+yt.board+'"></div>',i.sparePieces===!0&&(e+='<div class="'+yt.sparePieces+" "+yt.sparePiecesBottom+'"></div>'),e+="</div>"}function y(e){"black"!==e&&(e="white");var t="",n=f(u),r=8;"black"===e&&(n.reverse(),r=1);for(var o="white",a=0;8>a;a++){t+='<div class="'+yt.row+'">';for(var s=0;8>s;s++){var p=n[s]+r;t+='<div class="'+yt.square+" "+yt[o]+" square-"+p+'" style="width: '+ct+"px; height: "+ct+'px" id="'+Tt[p]+'" data-square="'+p+'">',i.showNotation===!0&&(("white"===e&&1===r||"black"===e&&8===r)&&(t+='<div class="'+yt.notation+" "+yt.alpha+'">'+n[s]+"</div>"),0===s&&(t+='<div class="'+yt.notation+" "+yt.numeric+'">'+r+"</div>")),t+="</div>",o="white"===o?"black":"white"}t+='<div class="'+yt.clearfix+'"></div></div>',o="white"===o?"black":"white","white"===e?r--:r++}return t}function E(e){return"function"==typeof i.pieceTheme?i.pieceTheme(e):"string"==typeof i.pieceTheme?i.pieceTheme.replace(/{piece}/g,e):(d(8272,"Unable to build image source for cfg.pieceTheme."),"")}function P(e,t,n){var r='<img src="'+E(e)+'" ';return n&&"string"==typeof n&&(r+='id="'+n+'" '),r+='alt="" class="'+yt.piece+'" data-piece="'+e+'" style="width: '+ct+"px;height: "+ct+"px;",t===!0&&(r+="display:none;"),r+='" />'}function S(e){var t=["wK","wQ","wR","wB","wN","wP"];"black"===e&&(t=["bK","bQ","bR","bB","bN","bP"]);for(var n="",r=0;r<t.length;r++)n+=P(t[r],!1,_t[t[r]]);return n}function O(e,t,n,r){var o=$("#"+Tt[e]),s=o.offset(),p=$("#"+Tt[t]),u=p.offset(),f=a();$("body").append(P(n,!0,f));var l=$("#"+f);l.css({display:"",position:"absolute",top:s.top,left:s.left}),o.find("."+yt.piece).remove();var c=function(){p.append(P(n)),l.remove(),"function"==typeof r&&r()},d={duration:i.moveSpeed,complete:c};l.animate(u,d)}function C(e,t,n){var r=$("#"+_t[e]).offset(),o=$("#"+Tt[t]),s=o.offset(),p=a();$("body").append(P(e,!0,p));var u=$("#"+p);u.css({display:"",position:"absolute",left:r.left,top:r.top});var f=function(){o.find("."+yt.piece).remove(),o.append(P(e)),u.remove(),"function"==typeof n&&n()},l={duration:i.moveSpeed,complete:f};u.animate(s,l)}function _(e,t,n){function r(){o++,o===e.length&&(I(),Pt=!1,i.hasOwnProperty("onMoveEnd")===!0&&"function"==typeof i.onMoveEnd&&i.onMoveEnd(f(t),f(n)))}Pt=!0;for(var o=0,a=0;a<e.length;a++)"clear"===e[a].type&&$("#"+Tt[e[a].square]+" ."+yt.piece).fadeOut(i.trashSpeed,r),"add"===e[a].type&&i.sparePieces!==!0&&$("#"+Tt[e[a].square]).append(P(e[a].piece,!0)).find("."+yt.piece).fadeIn(i.appearSpeed,r),"add"===e[a].type&&i.sparePieces===!0&&C(e[a].piece,e[a].square,r),"move"===e[a].type&&O(e[a].source,e[a].destination,e[a].piece,r)}function T(e,t){e=e.split("");var n=u.indexOf(e[0])+1,r=parseInt(e[1],10);t=t.split("");var o=u.indexOf(t[0])+1,i=parseInt(t[1],10),a=Math.abs(n-o),s=Math.abs(r-i);return a>=s?a:s}function k(e){for(var t=[],n=0;8>n;n++)for(var r=0;8>r;r++){var o=u[n]+(r+1);e!==o&&t.push({square:o,distance:T(e,o)})}t.sort(function(e,t){return e.distance-t.distance});for(var i=[],n=0;n<t.length;n++)i.push(t[n].square);return i}function A(e,t,n){for(var r=k(n),o=0;o<r.length;o++){var i=r[o];if(e.hasOwnProperty(i)===!0&&e[i]===t)return i}return!1}function x(e,t){e=f(e),t=f(t);var n=[],r={};for(var o in t)t.hasOwnProperty(o)===!0&&e.hasOwnProperty(o)===!0&&e[o]===t[o]&&(delete e[o],delete t[o]);for(var o in t)if(t.hasOwnProperty(o)===!0){var i=A(e,t[o],o);i!==!1&&(n.push({type:"move",source:i,destination:o,piece:t[o]}),delete e[i],delete t[o],r[o]=!0)}for(var o in t)t.hasOwnProperty(o)===!0&&(n.push({type:"add",square:o,piece:t[o]}),delete t[o]);for(var o in e)e.hasOwnProperty(o)===!0&&r.hasOwnProperty(o)!==!0&&(n.push({type:"clear",square:o,piece:e[o]}),delete e[o]);return n}function I(){pt.find("."+yt.piece).remove();for(var e in $t)$t.hasOwnProperty(e)===!0&&$("#"+Tt[e]).append(P($t[e]))}function q(){pt.html(y(Ot)),I(),i.sparePieces===!0&&("white"===Ot?(ft.html(S("black")),lt.html(S("white"))):(ft.html(S("white")),lt.html(S("black"))))}function D(e,t){e=f(e);for(var n in t)if(t.hasOwnProperty(n)===!0&&e.hasOwnProperty(n)===!0){var r=e[n];delete e[n],e[t[n]]=r}return e}function L(e){var t=f($t),n=f(e),r=p(t),o=p(n);r!==o&&(i.hasOwnProperty("onChange")===!0&&"function"==typeof i.onChange&&i.onChange(t,n),$t=e)}function N(e,t){for(var n in gt)if(gt.hasOwnProperty(n)===!0){var r=gt[n];if(e>=r.left&&e<r.left+ct&&t>=r.top&&t<r.top+ct)return n}return"offboard"}function R(){gt={};for(var e in Tt)Tt.hasOwnProperty(e)===!0&&(gt[e]=$("#"+Tt[e]).offset())}function B(){pt.find("."+yt.square).removeClass(yt.highlight1+" "+yt.highlight2)}function U(){function e(){I(),ut.css("display","none"),i.hasOwnProperty("onSnapbackEnd")===!0&&"function"==typeof i.onSnapbackEnd&&i.onSnapbackEnd(dt,vt,f($t),Ot)}if("spare"===vt)return void K();B();var t=$("#"+Tt[vt]).offset(),n={duration:i.snapbackSpeed,complete:e};ut.animate(t,n),Ct=!1}function K(){B();var e=f($t);delete e[vt],L(e),I(),ut.fadeOut(i.trashSpeed),Ct=!1}function Q(e){B();var t=f($t);delete t[vt],t[e]=dt,L(t);var n=$("#"+Tt[e]).offset(),r=function(){I(),ut.css("display","none"),i.hasOwnProperty("onSnapEnd")===!0&&"function"==typeof i.onSnapEnd&&i.onSnapEnd(vt,e,dt)},o={duration:i.snapSpeed,complete:r};ut.animate(n,o),Ct=!1}function M(e,t,n,r){("function"!=typeof i.onDragStart||i.onDragStart(e,t,f($t),Ot)!==!1)&&(Ct=!0,dt=t,vt=e,ht="spare"===e?"offboard":e,R(),ut.attr("src",E(t)).css({display:"",position:"absolute",left:n-ct/2,top:r-ct/2}),"spare"!==e&&$("#"+Tt[e]).addClass(yt.highlight1).find("."+yt.piece).css("display","none"))}function j(e,n){ut.css({left:e-ct/2,top:n-ct/2});var r=N(e,n);r!==ht&&(t(ht)===!0&&$("#"+Tt[ht]).removeClass(yt.highlight2),t(r)===!0&&$("#"+Tt[r]).addClass(yt.highlight2),"function"==typeof i.onDragMove&&i.onDragMove(r,ht,vt,dt,f($t),Ot),ht=r)}function H(e){var n="drop";if("offboard"===e&&"snapback"===i.dropOffBoard&&(n="snapback"),"offboard"===e&&"trash"===i.dropOffBoard&&(n="trash"),i.hasOwnProperty("onDrop")===!0&&"function"==typeof i.onDrop){var r=f($t);"spare"===vt&&t(e)===!0&&(r[e]=dt),t(vt)===!0&&"offboard"===e&&delete r[vt],t(vt)===!0&&t(e)===!0&&(delete r[vt],r[e]=dt);var o=f($t),a=i.onDrop(vt,e,dt,r,o,Ot);("snapback"===a||"trash"===a)&&(n=a)}"snapback"===n?U():"trash"===n?K():"drop"===n&&Q(e)}function z(){return"ontouchstart"in document.documentElement}function W(){return navigator&&navigator.userAgent&&-1!==navigator.userAgent.search(/MSIE/)}function X(e){e.preventDefault()}function Y(e){if(i.draggable===!0){var n=$(this).attr("data-square");t(n)===!0&&$t.hasOwnProperty(n)===!0&&M(n,$t[n],e.pageX,e.pageY)}}function J(e){if(i.draggable===!0){var n=$(this).attr("data-square");t(n)===!0&&$t.hasOwnProperty(n)===!0&&(e=e.originalEvent,M(n,$t[n],e.changedTouches[0].pageX,e.changedTouches[0].pageY))}}function G(e){if(i.sparePieces===!0){var t=$(this).attr("data-piece");M("spare",t,e.pageX,e.pageY)}}function F(e){if(i.sparePieces===!0){var t=$(this).attr("data-piece");e=e.originalEvent,M("spare",t,e.changedTouches[0].pageX,e.changedTouches[0].pageY)}}function Z(e){Ct===!0&&j(e.pageX,e.pageY)}function V(e){Ct===!0&&(e.preventDefault(),j(e.originalEvent.changedTouches[0].pageX,e.originalEvent.changedTouches[0].pageY))}function et(e){if(Ct===!0){var t=N(e.pageX,e.pageY);H(t)}}function tt(e){if(Ct===!0){var t=N(e.originalEvent.changedTouches[0].pageX,e.originalEvent.changedTouches[0].pageY);H(t)}}function nt(e){if(Ct===!1&&i.hasOwnProperty("onMouseoverSquare")===!0&&"function"==typeof i.onMouseoverSquare){var n=$(e.currentTarget).attr("data-square");if(t(n)===!0){var r=!1;$t.hasOwnProperty(n)===!0&&(r=$t[n]),i.onMouseoverSquare(n,r,f($t),Ot)}}}function rt(e){if(Ct===!1&&i.hasOwnProperty("onMouseoutSquare")===!0&&"function"==typeof i.onMouseoutSquare){var n=$(e.currentTarget).attr("data-square");if(t(n)===!0){var r=!1;$t.hasOwnProperty(n)===!0&&(r=$t[n]),i.onMouseoutSquare(n,r,f($t),Ot)}}}function ot(){$("body").on("mousedown mousemove","."+yt.piece,X),pt.on("mousedown","."+yt.square,Y),st.on("mousedown","."+yt.sparePieces+" ."+yt.piece,G),pt.on("mouseenter","."+yt.square,nt),pt.on("mouseleave","."+yt.square,rt),W()===!0?(document.ondragstart=function(){return!1},$("body").on("mousemove",Z),$("body").on("mouseup",et)):($(window).on("mousemove",Z),$(window).on("mouseup",et)),z()===!0&&(pt.on("touchstart","."+yt.square,J),st.on("touchstart","."+yt.sparePieces+" ."+yt.piece,F),$(window).on("touchmove",V),$(window).on("touchend",tt))}function it(){st.html(w()),pt=st.find("."+yt.board),i.sparePieces===!0&&(ft=st.find("."+yt.sparePiecesTop),lt=st.find("."+yt.sparePiecesBottom));var e=a();$("body").append(P("wP",!0,e)),ut=$("#"+e),St=parseInt(pt.css("borderLeftWidth"),10),Et.resize()}function at(){h()===!0&&g()===!0&&(b(),it(),ot())}i=i||{};var st,pt,ut,ft,lt,ct,dt,ht,vt,gt,mt="1.7.0",bt="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",wt=s(bt),yt={alpha:"alpha-d2270",black:"black-3c85d",board:"board-b72b1",chessboard:"chessboard-63f37",clearfix:"clearfix-7da63",highlight1:"highlight1-32417",highlight2:"highlight2-9c5d2",notation:"notation-322f9",numeric:"numeric-fc462",piece:"piece-417db",row:"row-5277c",sparePieces:"spare-pieces-7492f",sparePiecesBottom:"spare-pieces-bottom-ae20f",sparePiecesTop:"spare-pieces-top-4028b",square:"square-55d63",white:"white-1e1d7"},Et={},Pt=!1,St=2,Ot="white",$t={},Ct=!1,_t={},Tt={};return Et.clear=function(e){Et.position({},e)},Et.destroy=function(){st.html(""),ut.remove(),st.unbind()},Et.fen=function(){return Et.position("fen")},Et.flip=function(){Et.orientation("flip")},Et.move=function(){if(0!==arguments.length){for(var t=!0,n={},r=0;r<arguments.length;r++)if(arguments[r]!==!1)if(e(arguments[r])===!0){var o=arguments[r].split("-");n[o[0]]=o[1]}else d(2826,"Invalid move passed to the move method.",arguments[r]);else t=!1;var i=D($t,n);return Et.position(i,t),i}},Et.orientation=function(e){return 0===arguments.length?Ot:"white"===e||"black"===e?(Ot=e,void q()):"flip"===e?(Ot="white"===Ot?"black":"white",void q()):void d(5482,"Invalid value passed to the orientation method.",e)},Et.position=function(e,t){return 0===arguments.length?f($t):"string"==typeof e&&"fen"===e.toLowerCase()?p($t):(t!==!1&&(t=!0),"string"==typeof e&&"start"===e.toLowerCase()&&(e=f(wt)),r(e)===!0&&(e=s(e)),o(e)!==!0?void d(6482,"Invalid value passed to the position method.",e):void(t===!0?(_(x($t,e),$t,e),L(e)):(L(e),I())))},Et.resize=function(){ct=m(),pt.css("width",8*ct+"px"),ut.css({height:ct,width:ct}),i.sparePieces===!0&&st.find("."+yt.sparePieces).css("paddingLeft",ct+St+"px"),q()},Et.start=function(e){Et.position("start",e)},at(),Et},window.ChessBoard.fenToObj=s,window.ChessBoard.objToFen=p}(),angular.module("op").factory("Logic",["$rootScope","$http","$compile",function(e,t,n){function r(t,r,o,i,a,s){var p=$("<img/>").attr({src:"img/chesspieces/wikipedia/"+t+r+".png",height:"100%",width:"100%","ng-click":'Logic.move("'+a+'")',"tooltip-placement":"top",tooltip:i,"tooltip-animation":"false","tooltip-append-to-body":"true"}).addClass("move-alternative").addClass(a.replace("+",""));s&&p.addClass("castle"),p=n($(p))(e.$$childHead),p.appendTo($(".square-"+o))
}function o(){$(".move-alternative").remove(),$(".tooltip").remove();var e=u.opening(!0);e&&angular.forEach(e,function(t,n){if("name"!=n&&"eco"!=n){var o=a.turn(),i=e[n].name,s="",p="",u=n;if(u=u.replace("+",""),"O-O"==u)p="w"==o?"g1":"g8",s="K",r(o,s,p,i,n,!0),p="w"==o?"f1":"f8",s="R",r(o,s,p,i,n,!0);else if("O-O-O"==u)p="w"==o?"c1":"c8",s="K",r(o,s,p,i,n,!0),p="w"==o?"d1":"d8",s="R",r(o,s,p,i,n,!0);else{switch(u.length){case 2:s="P",p=u[0]+u[1];break;case 3:s=u[0],p=u[1]+u[2];break;case 4:s=u[0],s==s.toLowerCase()&&(s="P"),p=u[2]+u[3]}r(o,s,p,i,n,!1)}}})}var i;t.get("openings.json").success(function(e){i=e,o()});var a=new Chess,s={position:"start",draggable:!0,onDragStart:function(e,t){return a.game_over()===!0||"w"===a.turn()&&-1!==t.search(/^b/)||"b"===a.turn()&&-1!==t.search(/^w/)?!1:void 0},onDrop:function(t,n){var r=u.move({from:t,to:n,promotion:"q"});return null===r?"snapback":void e.$digest()}},p=new ChessBoard("board",s),u={move:function(e){var t=a.move(e);return null!=t&&p.position(a.fen()),o(),t},reset:function(){a.reset(),p.position("start"),o()},undo:function(){a.undo(),p.position(a.fen()),o()},fen:function(){return a.fen()},pgn:function(){return a.pgn()},getOpening:function(e,t){var n=i;if(!e)return n;for(var r=e.length,o=0;r>o;o++){if(!n[e[o]]){if(t)return null;break}n=n[e[o]]}return n},opening:function(e){var t=this.getOpening(a.history(),e);return t&&t.name&&(this.last_opening={name:t.name,eco:t.eco}),t},resizeBoard:function(){p.resize(),o()},flipBoard:function(){p.flip(),o()}};return u}]),angular.module("ui.bootstrap",["ui.bootstrap.tpls","ui.bootstrap.dropdownToggle","ui.bootstrap.position","ui.bootstrap.bindHtml","ui.bootstrap.tooltip"]),angular.module("ui.bootstrap.tpls",["template/tooltip/tooltip-html-unsafe-popup.html","template/tooltip/tooltip-popup.html"]),angular.module("ui.bootstrap.dropdownToggle",[]).directive("dropdownToggle",["$document","$location",function(e){var t=null,n=angular.noop;return{restrict:"CA",link:function(r,o){r.$watch("$location.path",function(){n()}),o.parent().bind("click",function(){n()}),o.bind("click",function(r){var i=o===t;r.preventDefault(),r.stopPropagation(),t&&n(),i||o.hasClass("disabled")||o.prop("disabled")||(o.parent().addClass("open"),t=o,n=function(r){r&&(r.preventDefault(),r.stopPropagation()),e.unbind("click",n),o.parent().removeClass("open"),n=angular.noop,t=null},e.bind("click",n))})}}}]),angular.module("ui.bootstrap.position",[]).factory("$position",["$document","$window",function(e,t){function n(e,n){return e.currentStyle?e.currentStyle[n]:t.getComputedStyle?t.getComputedStyle(e)[n]:e.style[n]}function r(e){return"static"===(n(e,"position")||"static")}var o=function(t){for(var n=e[0],o=t.offsetParent||n;o&&o!==n&&r(o);)o=o.offsetParent;return o||n};return{position:function(t){var n=this.offset(t),r={top:0,left:0},i=o(t[0]);i!=e[0]&&(r=this.offset(angular.element(i)),r.top+=i.clientTop-i.scrollTop,r.left+=i.clientLeft-i.scrollLeft);var a=t[0].getBoundingClientRect();return{width:a.width||t.prop("offsetWidth"),height:a.height||t.prop("offsetHeight"),top:n.top-r.top,left:n.left-r.left}},offset:function(n){var r=n[0].getBoundingClientRect();return{width:r.width||n.prop("offsetWidth"),height:r.height||n.prop("offsetHeight"),top:r.top+(t.pageYOffset||e[0].body.scrollTop||e[0].documentElement.scrollTop),left:r.left+(t.pageXOffset||e[0].body.scrollLeft||e[0].documentElement.scrollLeft)}}}}]),angular.module("ui.bootstrap.bindHtml",[]).directive("bindHtmlUnsafe",function(){return function(e,t,n){t.addClass("ng-binding").data("$binding",n.bindHtmlUnsafe),e.$watch(n.bindHtmlUnsafe,function(e){t.html(e||"")})}}),angular.module("ui.bootstrap.tooltip",["ui.bootstrap.position","ui.bootstrap.bindHtml"]).provider("$tooltip",function(){function e(e){var t=/[A-Z]/g,n="-";return e.replace(t,function(e,t){return(t?n:"")+e.toLowerCase()})}var t={placement:"top",animation:!0,popupDelay:0},n={mouseenter:"mouseleave",click:"click",focus:"blur"},r={};this.options=function(e){angular.extend(r,e)},this.setTriggers=function(e){angular.extend(n,e)},this.$get=["$window","$compile","$timeout","$parse","$document","$position","$interpolate",function(o,i,a,s,p,u,f){return function(o,l,c){function d(e){var t=e||h.trigger||c,r=n[t]||t;return{show:t,hide:r}}var h=angular.extend({},t,r),v=e(o),g=f.startSymbol(),m=f.endSymbol(),b="<div "+v+'-popup title="'+g+"tt_title"+m+'" content="'+g+"tt_content"+m+'" placement="'+g+"tt_placement"+m+'" animation="tt_animation" is-open="tt_isOpen"></div>';return{restrict:"EA",scope:!0,compile:function(){var e=i(b);return function(t,n,r){function i(){t.tt_isOpen?c():f()}function f(){(!$||t.$eval(r[l+"Enable"]))&&(t.tt_popupDelay?(E=a(v,t.tt_popupDelay,!1),E.then(function(e){e()})):v()())}function c(){t.$apply(function(){g()})}function v(){return t.tt_content?(m(),y&&a.cancel(y),w.css({top:0,left:0,display:"block"}),P?p.find("body").append(w):n.after(w),C(),t.tt_isOpen=!0,t.$digest(),C):angular.noop}function g(){t.tt_isOpen=!1,a.cancel(E),t.tt_animation?y=a(b,500):b()}function m(){w&&b(),w=e(t,function(){}),t.$digest()}function b(){w&&(w.remove(),w=null)}var w,y,E,P=angular.isDefined(h.appendToBody)?h.appendToBody:!1,S=d(void 0),O=!1,$=angular.isDefined(r[l+"Enable"]),C=function(){var e,r,o,i;switch(e=P?u.offset(n):u.position(n),r=w.prop("offsetWidth"),o=w.prop("offsetHeight"),t.tt_placement){case"right":i={top:e.top+e.height/2-o/2,left:e.left+e.width};break;case"bottom":i={top:e.top+e.height,left:e.left+e.width/2-r/2};break;case"left":i={top:e.top+e.height/2-o/2,left:e.left-r};break;default:i={top:e.top-o,left:e.left+e.width/2-r/2}}i.top+="px",i.left+="px",w.css(i)};t.tt_isOpen=!1,r.$observe(o,function(e){t.tt_content=e,!e&&t.tt_isOpen&&g()}),r.$observe(l+"Title",function(e){t.tt_title=e}),r.$observe(l+"Placement",function(e){t.tt_placement=angular.isDefined(e)?e:h.placement}),r.$observe(l+"PopupDelay",function(e){var n=parseInt(e,10);t.tt_popupDelay=isNaN(n)?h.popupDelay:n});var _=function(){O&&(n.unbind(S.show,f),n.unbind(S.hide,c))};r.$observe(l+"Trigger",function(e){_(),S=d(e),S.show===S.hide?n.bind(S.show,i):(n.bind(S.show,f),n.bind(S.hide,c)),O=!0});var T=t.$eval(r[l+"Animation"]);t.tt_animation=angular.isDefined(T)?!!T:h.animation,r.$observe(l+"AppendToBody",function(e){P=angular.isDefined(e)?s(e)(t):P}),P&&t.$on("$locationChangeSuccess",function(){t.tt_isOpen&&g()}),t.$on("$destroy",function(){a.cancel(y),a.cancel(E),_(),b()})}}}}}]}).directive("tooltipPopup",function(){return{restrict:"EA",replace:!0,scope:{content:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"template/tooltip/tooltip-popup.html"}}).directive("tooltip",["$tooltip",function(e){return e("tooltip","tooltip","mouseenter")}]).directive("tooltipHtmlUnsafePopup",function(){return{restrict:"EA",replace:!0,scope:{content:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"template/tooltip/tooltip-html-unsafe-popup.html"}}).directive("tooltipHtmlUnsafe",["$tooltip",function(e){return e("tooltipHtmlUnsafe","tooltip","mouseenter")}]),angular.module("template/tooltip/tooltip-html-unsafe-popup.html",[]).run(["$templateCache",function(e){e.put("template/tooltip/tooltip-html-unsafe-popup.html",'<div class="tooltip {{placement}}" ng-class="{ in: isOpen(), fade: animation() }">\n  <div class="tooltip-arrow"></div>\n  <div class="tooltip-inner" bind-html-unsafe="content"></div>\n</div>\n')}]),angular.module("template/tooltip/tooltip-popup.html",[]).run(["$templateCache",function(e){e.put("template/tooltip/tooltip-popup.html",'<div class="tooltip {{placement}}" ng-class="{ in: isOpen(), fade: animation() }">\n  <div class="tooltip-arrow"></div>\n  <div class="tooltip-inner" ng-bind="content"></div>\n</div>\n')}]);