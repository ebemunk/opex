"use strict";angular.module("op",["ngAnimate","ui.bootstrap","throttle"]),angular.module("op").directive("selectOnClick",function(){return{restrict:"A",link:function(e,t,n){t.on("click",function(){angular.element(".feninput").select()})}}}),angular.module("op").directive("pieceHighlight",function(){return{restrict:"A",link:function(e,t,n){t.on("mouseenter",function(){angular.element("."+n.pieceHighlight).addClass("move-alternative-hovered")}),t.on("mouseleave",function(){angular.element("."+n.pieceHighlight).removeClass("move-alternative-hovered")})}}}),angular.module("op").directive("popup",function(){return{restrict:"A",link:function(e,t,n){t.on("click",function(){window.open(n.popup,"share_popup","height=320, width=640, toolbar=no, menubar=no, scrollbars=no, resizable=no, location=no, directories=no, status=no")})}}}),angular.module("op").controller("boardCtrl",["$scope","$http","Logic","throttle",function(e,t,n,r){e.Logic=n,angular.element(document).ready(function(){$(window).on("resize",r(100,function(){n.resizeBoard()}))}),n.resizeBoard()}]),angular.module("throttle",[]).factory("throttle",["$timeout",function(e){return function(t,n,r,o){var i,a=0;"boolean"!=typeof n&&(o=r,r=n,n=void 0);var s=function(){var s=this,p=+new Date-a,u=arguments,f=function(){a=+new Date,r.apply(s,u)},l=function(){i=void 0};o&&!i&&f(),i&&e.cancel(i),void 0===o&&p>t?f():n!==!0&&(i=e(o?l:f,void 0===o?t-p:t))};return s}}]);var Chess=function(e){function t(){ae=new Array(128),se={w:R,b:R},pe=N,ue={w:0,b:0},fe=R,le=0,ce=1,de=[],he={},s(i())}function n(){r(z)}function r(e){var n=e.split(/\s+/),r=n[0],a=0;if(!o(e).valid)return!1;t();for(var p=0;p<r.length;p++){var f=r.charAt(p);if("/"===f)a+=8;else if(A(f))a+=parseInt(f,10);else{var l=f<"a"?N:L;u({type:f.toLowerCase(),color:l},T(a)),a++}}return pe=n[1],n[2].indexOf("K")>-1&&(ue.w|=V.KSIDE_CASTLE),n[2].indexOf("Q")>-1&&(ue.w|=V.QSIDE_CASTLE),n[2].indexOf("k")>-1&&(ue.b|=V.KSIDE_CASTLE),n[2].indexOf("q")>-1&&(ue.b|=V.QSIDE_CASTLE),fe="-"===n[3]?R:oe[n[3]],le=parseInt(n[4],10),ce=parseInt(n[5],10),s(i()),!0}function o(e){var t={0:"No errors.",1:"FEN string must contain six space-delimited fields.",2:"6th field (move number) must be a positive integer.",3:"5th field (half move counter) must be a non-negative integer.",4:"4th field (en-passant square) is invalid.",5:"3rd field (castling availability) is invalid.",6:"2nd field (side to move) is invalid.",7:"1st field (piece positions) does not contain 8 '/'-delimited rows.",8:"1st field (piece positions) is invalid [consecutive numbers].",9:"1st field (piece positions) is invalid [invalid piece].",10:"1st field (piece positions) is invalid [row too large]."},n=e.split(/\s+/);if(6!==n.length)return{valid:!1,error_number:1,error:t[1]};if(isNaN(n[5])||parseInt(n[5],10)<=0)return{valid:!1,error_number:2,error:t[2]};if(isNaN(n[4])||parseInt(n[4],10)<0)return{valid:!1,error_number:3,error:t[3]};if(!/^(-|[abcdefgh][36])$/.test(n[3]))return{valid:!1,error_number:4,error:t[4]};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(n[2]))return{valid:!1,error_number:5,error:t[5]};if(!/^(w|b)$/.test(n[1]))return{valid:!1,error_number:6,error:t[6]};var r=n[0].split("/");if(8!==r.length)return{valid:!1,error_number:7,error:t[7]};for(var o=0;o<r.length;o++){for(var i=0,a=!1,s=0;s<r[o].length;s++)if(isNaN(r[o][s])){if(!/^[prnbqkPRNBQK]$/.test(r[o][s]))return{valid:!1,error_number:9,error:t[9]};i+=1,a=!1}else{if(a)return{valid:!1,error_number:8,error:t[8]};i+=parseInt(r[o][s],10),a=!0}if(8!==i)return{valid:!1,error_number:10,error:t[10]}}return{valid:!0,error_number:0,error:t[0]}}function i(){for(var e=0,t="",n=oe.a8;n<=oe.h1;n++){if(null==ae[n])e++;else{e>0&&(t+=e,e=0);var r=ae[n].color,o=ae[n].type;t+=r===N?o.toUpperCase():o.toLowerCase()}n+1&136&&(e>0&&(t+=e),n!==oe.h1&&(t+="/"),e=0,n+=8)}var i="";ue[N]&V.KSIDE_CASTLE&&(i+="K"),ue[N]&V.QSIDE_CASTLE&&(i+="Q"),ue[L]&V.KSIDE_CASTLE&&(i+="k"),ue[L]&V.QSIDE_CASTLE&&(i+="q"),i=i||"-";var a=fe===R?"-":T(fe);return[t,pe,i,a,le,ce].join(" ")}function a(e){for(var t=0;t<e.length;t+=2)"string"==typeof e[t]&&"string"==typeof e[t+1]&&(he[e[t]]=e[t+1]);return he}function s(e){de.length>0||(e!==z?(he.SetUp="1",he.FEN=e):(delete he.SetUp,delete he.FEN))}function p(e){var t=ae[oe[e]];return t?{type:t.type,color:t.color}:null}function u(e,t){if(!("type"in e&&"color"in e))return!1;if(H.indexOf(e.type.toLowerCase())===-1)return!1;if(!(t in oe))return!1;var n=oe[t];return(e.type!=j||se[e.color]==R||se[e.color]==n)&&(ae[n]={type:e.type,color:e.color},e.type===j&&(se[e.color]=n),s(i()),!0)}function f(e){var t=p(e);return ae[oe[e]]=null,t&&t.type===j&&(se[t.color]=R),s(i()),t}function l(e,t,n,r,o){var i={color:pe,from:t,to:n,flags:r,piece:e[t].type};return o&&(i.flags|=V.PROMOTION,i.promotion=o),e[n]?i.captured=e[n].type:r&V.EP_CAPTURE&&(i.captured=B),i}function c(e){function t(e,t,n,r,o){if(e[n].type!==B||C(r)!==re&&C(r)!==ee)t.push(l(e,n,r,o));else for(var i=[M,Q,K,U],a=0,s=i.length;a<s;a++)t.push(l(e,n,r,o,i[a]))}var n=[],r=pe,o=k(r),i={b:ne,w:te},a=oe.a8,s=oe.h1,p=!1,u=!("undefined"!=typeof e&&"legal"in e)||e.legal;if("undefined"!=typeof e&&"square"in e){if(!(e.square in oe))return[];a=s=oe[e.square],p=!0}for(var f=a;f<=s;f++)if(136&f)f+=7;else{var c=ae[f];if(null!=c&&c.color===r)if(c.type===B){var d=f+X[r][0];if(null==ae[d]){t(ae,n,f,d,V.NORMAL);var d=f+X[r][1];i[r]===C(f)&&null==ae[d]&&t(ae,n,f,d,V.BIG_PAWN)}for(g=2;g<4;g++){var d=f+X[r][g];136&d||(null!=ae[d]&&ae[d].color===o?t(ae,n,f,d,V.CAPTURE):d===fe&&t(ae,n,f,fe,V.EP_CAPTURE))}}else for(var g=0,m=Y[c.type].length;g<m;g++)for(var b=Y[c.type][g],d=f;;){if(d+=b,136&d)break;if(null!=ae[d]){if(ae[d].color===r)break;t(ae,n,f,d,V.CAPTURE);break}if(t(ae,n,f,d,V.NORMAL),"n"===c.type||"k"===c.type)break}}if(!p||s===se[r]){if(ue[r]&V.KSIDE_CASTLE){var w=se[r],y=w+2;null!=ae[w+1]||null!=ae[y]||h(o,se[r])||h(o,w+1)||h(o,y)||t(ae,n,se[r],y,V.KSIDE_CASTLE)}if(ue[r]&V.QSIDE_CASTLE){var w=se[r],y=w-2;null!=ae[w-1]||null!=ae[w-2]||null!=ae[w-3]||h(o,se[r])||h(o,w-1)||h(o,y)||t(ae,n,se[r],y,V.QSIDE_CASTLE)}}if(!u)return n;for(var E=[],f=0,m=n.length;f<m;f++)P(n[f]),v(r)||E.push(n[f]),S();return E}function d(e){var t="";if(e.flags&V.KSIDE_CASTLE)t="O-O";else if(e.flags&V.QSIDE_CASTLE)t="O-O-O";else{var n=O(e);e.piece!==B&&(t+=e.piece.toUpperCase()+n),e.flags&(V.CAPTURE|V.EP_CAPTURE)&&(e.piece===B&&(t+=T(e.from)[0]),t+="x"),t+=T(e.to),e.flags&V.PROMOTION&&(t+="="+e.promotion.toUpperCase())}return P(e),g()&&(t+=m()?"#":"+"),S(),t}function h(e,t){for(var n=oe.a8;n<=oe.h1;n++)if(136&n)n+=7;else if(null!=ae[n]&&ae[n].color===e){var r=ae[n],o=n-t,i=o+119;if(J[i]&1<<F[r.type]){if(r.type===B){if(o>0){if(r.color===N)return!0}else if(r.color===L)return!0;continue}if("n"===r.type||"k"===r.type)return!0;for(var a=G[i],s=n+a,p=!1;s!==t;){if(null!=ae[s]){p=!0;break}s+=a}if(!p)return!0}}return!1}function v(e){return h(k(e),se[e])}function g(){return v(pe)}function m(){return g()&&0===c().length}function b(){return!g()&&0===c().length}function w(){for(var e={},t=[],n=0,r=0,o=oe.a8;o<=oe.h1;o++)if(r=(r+1)%2,136&o)o+=7;else{var i=ae[o];i&&(e[i.type]=i.type in e?e[i.type]+1:1,i.type===K&&t.push(r),n++)}if(2===n)return!0;if(3===n&&(1===e[K]||1===e[U]))return!0;if(n===e[K]+2){for(var a=0,s=t.length,o=0;o<s;o++)a+=t[o];if(0===a||a===s)return!0}return!1}function y(){for(var e=[],t={},n=!1;;){var r=S();if(!r)break;e.push(r)}for(;;){var o=i().split(" ").slice(0,4).join(" ");if(t[o]=o in t?t[o]+1:1,t[o]>=3&&(n=!0),!e.length)break;P(e.pop())}return n}function E(e){de.push({move:e,kings:{b:se.b,w:se.w},turn:pe,castling:{b:ue.b,w:ue.w},ep_square:fe,half_moves:le,move_number:ce})}function P(e){var t=pe,n=k(t);if(E(e),ae[e.to]=ae[e.from],ae[e.from]=null,e.flags&V.EP_CAPTURE&&(pe===L?ae[e.to-16]=null:ae[e.to+16]=null),e.flags&V.PROMOTION&&(ae[e.to]={type:e.promotion,color:t}),ae[e.to].type===j){if(se[ae[e.to].color]=e.to,e.flags&V.KSIDE_CASTLE){var r=e.to-1,o=e.to+1;ae[r]=ae[o],ae[o]=null}else if(e.flags&V.QSIDE_CASTLE){var r=e.to+1,o=e.to-2;ae[r]=ae[o],ae[o]=null}ue[t]=""}if(ue[t])for(var i=0,a=ie[t].length;i<a;i++)if(e.from===ie[t][i].square&&ue[t]&ie[t][i].flag){ue[t]^=ie[t][i].flag;break}if(ue[n])for(var i=0,a=ie[n].length;i<a;i++)if(e.to===ie[n][i].square&&ue[n]&ie[n][i].flag){ue[n]^=ie[n][i].flag;break}fe=e.flags&V.BIG_PAWN?"b"===pe?e.to-16:e.to+16:R,e.piece===B?le=0:e.flags&(V.CAPTURE|V.EP_CAPTURE)?le=0:le++,pe===L&&ce++,pe=k(pe)}function S(){var e=de.pop();if(null==e)return null;var t=e.move;se=e.kings,pe=e.turn,ue=e.castling,fe=e.ep_square,le=e.half_moves,ce=e.move_number;var n=pe,r=k(pe);if(ae[t.from]=ae[t.to],ae[t.from].type=t.piece,ae[t.to]=null,t.flags&V.CAPTURE)ae[t.to]={type:t.captured,color:r};else if(t.flags&V.EP_CAPTURE){var o;o=n===L?t.to-16:t.to+16,ae[o]={type:B,color:r}}if(t.flags&(V.KSIDE_CASTLE|V.QSIDE_CASTLE)){var i,a;t.flags&V.KSIDE_CASTLE?(i=t.to+1,a=t.to-1):t.flags&V.QSIDE_CASTLE&&(i=t.to-2,a=t.to+1),ae[i]=ae[a],ae[a]=null}return t}function O(e){for(var t=c(),n=e.from,r=e.to,o=e.piece,i=0,a=0,s=0,p=0,u=t.length;p<u;p++){var f=t[p].from,l=t[p].to,d=t[p].piece;o===d&&n!==f&&r===l&&(i++,C(n)===C(f)&&a++,_(n)===_(f)&&s++)}return i>0?a>0&&s>0?T(n):s>0?T(n).charAt(1):T(n).charAt(0):""}function $(){for(var e="   +------------------------+\n",t=oe.a8;t<=oe.h1;t++){if(0===_(t)&&(e+=" "+"87654321"[C(t)]+" |"),null==ae[t])e+=" . ";else{var n=ae[t].type,r=ae[t].color,o=r===N?n.toUpperCase():n.toLowerCase();e+=" "+o+" "}t+1&136&&(e+="|\n",t+=8)}return e+="   +------------------------+\n",e+="     a  b  c  d  e  f  g  h\n"}function C(e){return e>>4}function _(e){return 15&e}function T(e){var t=_(e),n=C(e);return"abcdefgh".substring(t,t+1)+"87654321".substring(n,n+1)}function k(e){return e===N?L:N}function A(e){return"0123456789".indexOf(e)!==-1}function x(e){var t=I(e);t.san=d(t),t.to=T(t.to),t.from=T(t.from);var n="";for(var r in V)V[r]&t.flags&&(n+=Z[r]);return t.flags=n,t}function I(e){var t=e instanceof Array?[]:{};for(var n in e)"object"==typeof n?t[n]=I(e[n]):t[n]=e[n];return t}function q(e){return e.replace(/^\s+|\s+$/g,"")}function D(e){for(var t=c({legal:!1}),n=0,r=pe,o=0,i=t.length;o<i;o++){if(P(t[o]),!v(r))if(e-1>0){var a=D(e-1);n+=a}else n++;S()}return n}var L="b",N="w",R=-1,B="p",U="n",K="b",Q="r",M="q",j="k",H="pnbrqkPNBRQK",z="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",W=["1-0","0-1","1/2-1/2","*"],X={b:[16,32,17,15],w:[-16,-32,-17,-15]},Y={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},J=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],G=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],F={p:0,n:1,b:2,r:3,q:4,k:5},Z={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},V={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},ee=7,te=6,ne=1,re=0,oe={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},ie={w:[{square:oe.a1,flag:V.QSIDE_CASTLE},{square:oe.h1,flag:V.KSIDE_CASTLE}],b:[{square:oe.a8,flag:V.QSIDE_CASTLE},{square:oe.h8,flag:V.KSIDE_CASTLE}]},ae=new Array(128),se={w:R,b:R},pe=N,ue={w:0,b:0},fe=R,le=0,ce=1,de=[],he={};return r("undefined"==typeof e?z:e),{WHITE:N,BLACK:L,PAWN:B,KNIGHT:U,BISHOP:K,ROOK:Q,QUEEN:M,KING:j,SQUARES:function(){for(var e=[],t=oe.a8;t<=oe.h1;t++)136&t?t+=7:e.push(T(t));return e}(),FLAGS:Z,load:function(e){return r(e)},reset:function(){return n()},moves:function(e){for(var t=c(e),n=[],r=0,o=t.length;r<o;r++)"undefined"!=typeof e&&"verbose"in e&&e.verbose?n.push(x(t[r])):n.push(d(t[r]));return n},in_check:function(){return g()},in_checkmate:function(){return m()},in_stalemate:function(){return b()},in_draw:function(){return le>=100||b()||w()||y()},insufficient_material:function(){return w()},in_threefold_repetition:function(){return y()},game_over:function(){return le>=100||m()||b()||w()||y()},validate_fen:function(e){return o(e)},fen:function(){return i()},pgn:function(e){var t="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\n",n="object"==typeof e&&"number"==typeof e.max_width?e.max_width:0,r=[],o=!1;for(var i in he)r.push("["+i+' "'+he[i]+'"]'+t),o=!0;o&&de.length&&r.push(t);for(var a=[];de.length>0;)a.push(S());for(var s=[],p="",u=1;a.length>0;){var f=a.pop();1===u&&"b"===f.color?(p="1. ...",u++):"w"===f.color&&(p.length&&s.push(p),p=u+".",u++),p=p+" "+d(f),P(f)}if(p.length&&s.push(p),"undefined"!=typeof he.Result&&s.push(he.Result),0===n)return r.join("")+s.join(" ");for(var l=0,i=0;i<s.length;i++)l+s[i].length>n&&0!==i?(" "===r[r.length-1]&&r.pop(),r.push(t),l=0):0!==i&&(r.push(" "),l++),r.push(s[i]),l+=s[i].length;return r.join("")},load_pgn:function(e,t){function r(e){return e.replace(/\\/g,"\\")}function o(e){for(var t=c(),n=0,r=t.length;n<r;n++)if(e.replace(/[+#?!=]+$/,"")==d(t[n]).replace(/[+#?!=]+$/,""))return t[n];return null}function i(e){return o(q(e))}function s(e){var t=!1;for(var n in e)t=!0;return t}function p(e,t){for(var n="object"==typeof t&&"string"==typeof t.newline_char?t.newline_char:"\r?\n",o={},i=e.split(new RegExp(r(n))),a="",s="",p=0;p<i.length;p++)a=i[p].replace(/^\[([A-Z][A-Za-z]*)\s.*\]$/,"$1"),s=i[p].replace(/^\[[A-Za-z]+\s"(.*)"\]$/,"$1"),q(a).length>0&&(o[a]=s);return o}var u="object"==typeof t&&"string"==typeof t.newline_char?t.newline_char:"\r?\n",f=new RegExp("^(\\[(.|"+r(u)+")*\\])("+r(u)+")*1.("+r(u)+"|.)*$","g"),l=e.replace(f,"$1");"["!==l[0]&&(l=""),n();var h=p(l,t);for(var v in h)a([v,h[v]]);var g=e.replace(l,"").replace(new RegExp(r(u),"g")," ");g=g.replace(/(\{[^}]+\})+?/g,""),g=g.replace(/\d+\./g,"");var m=q(g).split(new RegExp(/\s+/));m=m.join(",").replace(/,,+/g,",").split(",");for(var b="",w=0;w<m.length-1;w++){if(b=i(m[w]),null==b)return!1;P(b)}if(b=m[m.length-1],W.indexOf(b)>-1)s(he)&&"undefined"==typeof he.Result&&a(["Result",b]);else{if(b=i(b),null==b)return!1;P(b)}return!0},header:function(){return a(arguments)},ascii:function(){return $()},turn:function(){return pe},move:function(e){var t=null,n=c();if("string"==typeof e){for(var r=0,o=n.length;r<o;r++)if(e===d(n[r])){t=n[r];break}}else if("object"==typeof e)for(var r=0,o=n.length;r<o;r++)if(!(e.from!==T(n[r].from)||e.to!==T(n[r].to)||"promotion"in n[r]&&e.promotion!==n[r].promotion)){t=n[r];break}if(!t)return null;var i=x(t);return P(t),i},undo:function(){var e=S();return e?x(e):null},clear:function(){return t()},put:function(e,t){return u(e,t)},get:function(e){return p(e)},remove:function(e){return f(e)},perft:function(e){return D(e)},square_color:function(e){if(e in oe){var t=oe[e];return(C(t)+_(t))%2===0?"light":"dark"}return null},history:function(e){for(var t=[],n=[],r=("undefined"!=typeof e&&"verbose"in e&&e.verbose);de.length>0;)t.push(S());for(;t.length>0;){var o=t.pop();r?n.push(x(o)):n.push(d(o)),P(o)}return n}}};"undefined"!=typeof exports&&(exports.Chess=Chess),"undefined"!=typeof define&&define(function(){return Chess}),function(){function e(e){if("string"!=typeof e)return!1;var n=e.split("-");return 2===n.length&&(t(n[0])===!0&&t(n[1])===!0)}function t(e){return"string"==typeof e&&e.search(/^[a-h][1-8]$/)!==-1}function n(e){return"string"==typeof e&&e.search(/^[bw][KQRNBP]$/)!==-1}function r(e){if("string"!=typeof e)return!1;e=e.replace(/ .+$/,"");var t=e.split("/");if(8!==t.length)return!1;for(var n=0;n<8;n++)if(""===t[n]||t[n].length>8||t[n].search(/[^kqrbnpKQRNBP1-8]/)!==-1)return!1;return!0}function o(e){if("object"!=typeof e)return!1;for(var r in e)if(e.hasOwnProperty(r)===!0&&(t(r)!==!0||n(e[r])!==!0))return!1;return!0}function i(e){return e.toLowerCase()===e?"b"+e.toUpperCase():"w"+e.toUpperCase()}function a(e){var t=e.split("");return"w"===t[0]?t[1].toUpperCase():t[1].toLowerCase()}function s(e){if(r(e)!==!0)return!1;e=e.replace(/ .+$/,"");for(var t=e.split("/"),n={},o=8,a=0;a<8;a++){for(var s=t[a].split(""),p=0,f=0;f<s.length;f++)if(s[f].search(/[1-8]/)!==-1){var l=parseInt(s[f],10);p+=l}else{var c=u[p]+o;n[c]=i(s[f]),p++}o--}return n}function p(e){if(o(e)!==!0)return!1;for(var t="",n=8,r=0;r<8;r++){for(var i=0;i<8;i++){var s=u[i]+n;t+=e.hasOwnProperty(s)===!0?a(e[s]):"1"}7!==r&&(t+="/"),n--}return t=t.replace(/11111111/g,"8"),t=t.replace(/1111111/g,"7"),t=t.replace(/111111/g,"6"),t=t.replace(/11111/g,"5"),t=t.replace(/1111/g,"4"),t=t.replace(/111/g,"3"),t=t.replace(/11/g,"2")}var u="abcdefgh".split("");window.ChessBoard=window.ChessBoard||function(n,i){function a(){return"xxxx-xxxx-xxxx-xxxx-xxxx-xxxx-xxxx-xxxx".replace(/x/g,function(e){var t=16*Math.random()|0;return t.toString(16)})}function f(e){return JSON.parse(JSON.stringify(e))}function l(e){var t=e.split(".");return{major:parseInt(t[0],10),minor:parseInt(t[1],10),patch:parseInt(t[2],10)}}function c(e,t){e=l(e),t=l(t);var n=1e4*e.major*1e4+1e4*e.minor+e.patch,r=1e4*t.major*1e4+1e4*t.minor+t.patch;return n>=r}function d(e,t,n){if(i.hasOwnProperty("showErrors")===!0&&i.showErrors!==!1){var r="ChessBoard Error "+e+": "+t;return"console"===i.showErrors&&"object"==typeof console&&"function"==typeof console.log?(console.log(r),void(arguments.length>=2&&console.log(n))):"alert"===i.showErrors?(n&&(r+="\n\n"+JSON.stringify(n)),void window.alert(r)):void("function"==typeof i.showErrors&&i.showErrors(e,t,n))}}function h(){if("string"==typeof n){if(""===n)return window.alert("ChessBoard Error 1001: The first argument to ChessBoard() cannot be an empty string.\n\nExiting..."),!1;var e=document.getElementById(n);if(!e)return window.alert('ChessBoard Error 1002: Element with id "'+n+'" does not exist in the DOM.\n\nExiting...'),!1;se=$(e)}else if(se=$(n),1!==se.length)return window.alert("ChessBoard Error 1003: The first argument to ChessBoard() must be an ID or a single DOM node.\n\nExiting..."),!1;return window.JSON&&"function"==typeof JSON.stringify&&"function"==typeof JSON.parse?!(!$.fn||!$.fn.jquery||c($.fn.jquery,me)!==!0)||(window.alert("ChessBoard Error 1005: Unable to find a valid version of jQuery. Please include jQuery "+me+" or higher on the page.\n\nExiting..."),!1):(window.alert("ChessBoard Error 1004: JSON does not exist. Please include a JSON polyfill.\n\nExiting..."),!1)}function v(e){return"fast"===e||"slow"===e||parseInt(e,10)+""==e+""&&e>=0}function g(){return"string"!=typeof i&&o(i)!==!0||(i={position:i}),"black"!==i.orientation&&(i.orientation="white"),Oe=i.orientation,i.showNotation!==!1&&(i.showNotation=!0),i.draggable!==!0&&(i.draggable=!1),"trash"!==i.dropOffBoard&&(i.dropOffBoard="snapback"),i.sparePieces!==!0&&(i.sparePieces=!1),i.sparePieces===!0&&(i.draggable=!0),(i.hasOwnProperty("pieceTheme")!==!0||"string"!=typeof i.pieceTheme&&"function"!=typeof i.pieceTheme)&&(i.pieceTheme="img/chesspieces/wikipedia/{piece}.png"),i.hasOwnProperty("appearSpeed")===!0&&v(i.appearSpeed)===!0||(i.appearSpeed=200),i.hasOwnProperty("moveSpeed")===!0&&v(i.moveSpeed)===!0||(i.moveSpeed=200),i.hasOwnProperty("snapbackSpeed")===!0&&v(i.snapbackSpeed)===!0||(i.snapbackSpeed=50),i.hasOwnProperty("snapSpeed")===!0&&v(i.snapSpeed)===!0||(i.snapSpeed=25),i.hasOwnProperty("trashSpeed")===!0&&v(i.trashSpeed)===!0||(i.trashSpeed=100),i.hasOwnProperty("position")===!0&&("start"===i.position?$e=f(we):r(i.position)===!0?$e=s(i.position):o(i.position)===!0?$e=f(i.position):d(7263,"Invalid value passed to config.position.",i.position)),!0}function m(){var e=parseInt(se.css("width"),10);if(!e||e<=0)return 0;for(var t=e-1;t%8!==0&&t>0;)t--;return t/8}function b(){for(var e=0;e<u.length;e++)for(var t=1;t<=8;t++){var n=u[e]+t;Te[n]=n+"-"+a()}for(var r="KQRBNP".split(""),e=0;e<r.length;e++){var o="w"+r[e],i="b"+r[e];_e[o]=o+"-"+a(),_e[i]=i+"-"+a()}}function w(){var e='<div class="'+ye.chessboard+'">';return i.sparePieces===!0&&(e+='<div class="'+ye.sparePieces+" "+ye.sparePiecesTop+'"></div>'),e+='<div class="'+ye.board+'"></div>',i.sparePieces===!0&&(e+='<div class="'+ye.sparePieces+" "+ye.sparePiecesBottom+'"></div>'),e+="</div>"}function y(e){"black"!==e&&(e="white");var t="",n=f(u),r=8;"black"===e&&(n.reverse(),r=1);for(var o="white",a=0;a<8;a++){t+='<div class="'+ye.row+'">';for(var s=0;s<8;s++){var p=n[s]+r;t+='<div class="'+ye.square+" "+ye[o]+" square-"+p+'" style="width: '+ce+"px; height: "+ce+'px" id="'+Te[p]+'" data-square="'+p+'">',i.showNotation===!0&&(("white"===e&&1===r||"black"===e&&8===r)&&(t+='<div class="'+ye.notation+" "+ye.alpha+'">'+n[s]+"</div>"),0===s&&(t+='<div class="'+ye.notation+" "+ye.numeric+'">'+r+"</div>")),t+="</div>",o="white"===o?"black":"white"}t+='<div class="'+ye.clearfix+'"></div></div>',o="white"===o?"black":"white","white"===e?r--:r++}return t}function E(e){return"function"==typeof i.pieceTheme?i.pieceTheme(e):"string"==typeof i.pieceTheme?i.pieceTheme.replace(/{piece}/g,e):(d(8272,"Unable to build image source for cfg.pieceTheme."),"")}function P(e,t,n){var r='<img src="'+E(e)+'" ';return n&&"string"==typeof n&&(r+='id="'+n+'" '),r+='alt="" class="'+ye.piece+'" data-piece="'+e+'" style="width: '+ce+"px;height: "+ce+"px;",t===!0&&(r+="display:none;"),r+='" />'}function S(e){var t=["wK","wQ","wR","wB","wN","wP"];"black"===e&&(t=["bK","bQ","bR","bB","bN","bP"]);for(var n="",r=0;r<t.length;r++)n+=P(t[r],!1,_e[t[r]]);return n}function O(e,t,n,r){var o=$("#"+Te[e]),s=o.offset(),p=$("#"+Te[t]),u=p.offset(),f=a();$("body").append(P(n,!0,f));var l=$("#"+f);l.css({display:"",position:"absolute",top:s.top,left:s.left}),o.find("."+ye.piece).remove();var c=function(){p.append(P(n)),l.remove(),"function"==typeof r&&r()},d={duration:i.moveSpeed,complete:c};l.animate(u,d)}function C(e,t,n){var r=$("#"+_e[e]).offset(),o=$("#"+Te[t]),s=o.offset(),p=a();$("body").append(P(e,!0,p));var u=$("#"+p);u.css({display:"",position:"absolute",left:r.left,top:r.top});var f=function(){o.find("."+ye.piece).remove(),o.append(P(e)),u.remove(),"function"==typeof n&&n()},l={duration:i.moveSpeed,complete:f};u.animate(s,l)}function _(e,t,n){function r(){o++,o===e.length&&(I(),Pe=!1,i.hasOwnProperty("onMoveEnd")===!0&&"function"==typeof i.onMoveEnd&&i.onMoveEnd(f(t),f(n)))}Pe=!0;for(var o=0,a=0;a<e.length;a++)"clear"===e[a].type&&$("#"+Te[e[a].square]+" ."+ye.piece).fadeOut(i.trashSpeed,r),"add"===e[a].type&&i.sparePieces!==!0&&$("#"+Te[e[a].square]).append(P(e[a].piece,!0)).find("."+ye.piece).fadeIn(i.appearSpeed,r),"add"===e[a].type&&i.sparePieces===!0&&C(e[a].piece,e[a].square,r),"move"===e[a].type&&O(e[a].source,e[a].destination,e[a].piece,r)}function T(e,t){e=e.split("");var n=u.indexOf(e[0])+1,r=parseInt(e[1],10);t=t.split("");var o=u.indexOf(t[0])+1,i=parseInt(t[1],10),a=Math.abs(n-o),s=Math.abs(r-i);return a>=s?a:s}function k(e){for(var t=[],n=0;n<8;n++)for(var r=0;r<8;r++){var o=u[n]+(r+1);e!==o&&t.push({square:o,distance:T(e,o)})}t.sort(function(e,t){return e.distance-t.distance});for(var i=[],n=0;n<t.length;n++)i.push(t[n].square);return i}function A(e,t,n){for(var r=k(n),o=0;o<r.length;o++){var i=r[o];if(e.hasOwnProperty(i)===!0&&e[i]===t)return i}return!1}function x(e,t){e=f(e),t=f(t);var n=[],r={};for(var o in t)t.hasOwnProperty(o)===!0&&e.hasOwnProperty(o)===!0&&e[o]===t[o]&&(delete e[o],delete t[o]);for(var o in t)if(t.hasOwnProperty(o)===!0){var i=A(e,t[o],o);i!==!1&&(n.push({type:"move",source:i,destination:o,piece:t[o]}),delete e[i],delete t[o],r[o]=!0)}for(var o in t)t.hasOwnProperty(o)===!0&&(n.push({type:"add",square:o,piece:t[o]}),delete t[o]);for(var o in e)e.hasOwnProperty(o)===!0&&r.hasOwnProperty(o)!==!0&&(n.push({type:"clear",square:o,piece:e[o]}),delete e[o]);return n}function I(){pe.find("."+ye.piece).remove();for(var e in $e)$e.hasOwnProperty(e)===!0&&$("#"+Te[e]).append(P($e[e]))}function q(){pe.html(y(Oe)),I(),i.sparePieces===!0&&("white"===Oe?(fe.html(S("black")),le.html(S("white"))):(fe.html(S("white")),le.html(S("black"))))}function D(e,t){e=f(e);for(var n in t)if(t.hasOwnProperty(n)===!0&&e.hasOwnProperty(n)===!0){var r=e[n];delete e[n],e[t[n]]=r}return e}function L(e){var t=f($e),n=f(e),r=p(t),o=p(n);r!==o&&(i.hasOwnProperty("onChange")===!0&&"function"==typeof i.onChange&&i.onChange(t,n),$e=e)}function N(e,t){for(var n in ge)if(ge.hasOwnProperty(n)===!0){var r=ge[n];if(e>=r.left&&e<r.left+ce&&t>=r.top&&t<r.top+ce)return n}return"offboard"}function R(){ge={};for(var e in Te)Te.hasOwnProperty(e)===!0&&(ge[e]=$("#"+Te[e]).offset())}function B(){pe.find("."+ye.square).removeClass(ye.highlight1+" "+ye.highlight2)}function U(){function e(){I(),ue.css("display","none"),i.hasOwnProperty("onSnapbackEnd")===!0&&"function"==typeof i.onSnapbackEnd&&i.onSnapbackEnd(de,ve,f($e),Oe)}if("spare"===ve)return void K();B();var t=$("#"+Te[ve]).offset(),n={duration:i.snapbackSpeed,complete:e};ue.animate(t,n),Ce=!1}function K(){B();var e=f($e);delete e[ve],L(e),I(),ue.fadeOut(i.trashSpeed),Ce=!1}function Q(e){B();var t=f($e);delete t[ve],t[e]=de,L(t);var n=$("#"+Te[e]).offset(),r=function(){I(),ue.css("display","none"),i.hasOwnProperty("onSnapEnd")===!0&&"function"==typeof i.onSnapEnd&&i.onSnapEnd(ve,e,de)},o={duration:i.snapSpeed,complete:r};ue.animate(n,o),Ce=!1}function M(e,t,n,r){"function"==typeof i.onDragStart&&i.onDragStart(e,t,f($e),Oe)===!1||(Ce=!0,de=t,ve=e,he="spare"===e?"offboard":e,R(),ue.attr("src",E(t)).css({display:"",position:"absolute",left:n-ce/2,top:r-ce/2}),"spare"!==e&&$("#"+Te[e]).addClass(ye.highlight1).find("."+ye.piece).css("display","none"))}function j(e,n){ue.css({left:e-ce/2,top:n-ce/2});var r=N(e,n);r!==he&&(t(he)===!0&&$("#"+Te[he]).removeClass(ye.highlight2),t(r)===!0&&$("#"+Te[r]).addClass(ye.highlight2),"function"==typeof i.onDragMove&&i.onDragMove(r,he,ve,de,f($e),Oe),he=r)}function H(e){var n="drop";if("offboard"===e&&"snapback"===i.dropOffBoard&&(n="snapback"),"offboard"===e&&"trash"===i.dropOffBoard&&(n="trash"),i.hasOwnProperty("onDrop")===!0&&"function"==typeof i.onDrop){var r=f($e);"spare"===ve&&t(e)===!0&&(r[e]=de),t(ve)===!0&&"offboard"===e&&delete r[ve],t(ve)===!0&&t(e)===!0&&(delete r[ve],r[e]=de);var o=f($e),a=i.onDrop(ve,e,de,r,o,Oe);"snapback"!==a&&"trash"!==a||(n=a)}"snapback"===n?U():"trash"===n?K():"drop"===n&&Q(e)}function z(){return"ontouchstart"in document.documentElement}function W(){return navigator&&navigator.userAgent&&navigator.userAgent.search(/MSIE/)!==-1}function X(e){e.preventDefault()}function Y(e){if(i.draggable===!0){var n=$(this).attr("data-square");t(n)===!0&&$e.hasOwnProperty(n)===!0&&M(n,$e[n],e.pageX,e.pageY)}}function J(e){if(i.draggable===!0){var n=$(this).attr("data-square");t(n)===!0&&$e.hasOwnProperty(n)===!0&&(e=e.originalEvent,M(n,$e[n],e.changedTouches[0].pageX,e.changedTouches[0].pageY))}}function G(e){if(i.sparePieces===!0){var t=$(this).attr("data-piece");M("spare",t,e.pageX,e.pageY)}}function F(e){if(i.sparePieces===!0){var t=$(this).attr("data-piece");e=e.originalEvent,M("spare",t,e.changedTouches[0].pageX,e.changedTouches[0].pageY)}}function Z(e){Ce===!0&&j(e.pageX,e.pageY)}function V(e){Ce===!0&&(e.preventDefault(),j(e.originalEvent.changedTouches[0].pageX,e.originalEvent.changedTouches[0].pageY))}function ee(e){if(Ce===!0){var t=N(e.pageX,e.pageY);H(t)}}function te(e){if(Ce===!0){var t=N(e.originalEvent.changedTouches[0].pageX,e.originalEvent.changedTouches[0].pageY);H(t)}}function ne(e){if(Ce===!1&&i.hasOwnProperty("onMouseoverSquare")===!0&&"function"==typeof i.onMouseoverSquare){var n=$(e.currentTarget).attr("data-square");if(t(n)===!0){var r=!1;$e.hasOwnProperty(n)===!0&&(r=$e[n]),i.onMouseoverSquare(n,r,f($e),Oe)}}}function re(e){if(Ce===!1&&i.hasOwnProperty("onMouseoutSquare")===!0&&"function"==typeof i.onMouseoutSquare){var n=$(e.currentTarget).attr("data-square");if(t(n)===!0){var r=!1;$e.hasOwnProperty(n)===!0&&(r=$e[n]),i.onMouseoutSquare(n,r,f($e),Oe)}}}function oe(){$("body").on("mousedown mousemove","."+ye.piece,X),pe.on("mousedown","."+ye.square,Y),se.on("mousedown","."+ye.sparePieces+" ."+ye.piece,G),pe.on("mouseenter","."+ye.square,ne),pe.on("mouseleave","."+ye.square,re),W()===!0?(document.ondragstart=function(){return!1},$("body").on("mousemove",Z),$("body").on("mouseup",ee)):($(window).on("mousemove",Z),$(window).on("mouseup",ee)),z()===!0&&(pe.on("touchstart","."+ye.square,J),se.on("touchstart","."+ye.sparePieces+" ."+ye.piece,F),$(window).on("touchmove",V),$(window).on("touchend",te))}function ie(){se.html(w()),pe=se.find("."+ye.board),i.sparePieces===!0&&(fe=se.find("."+ye.sparePiecesTop),le=se.find("."+ye.sparePiecesBottom));var e=a();$("body").append(P("wP",!0,e)),ue=$("#"+e),Se=parseInt(pe.css("borderLeftWidth"),10),Ee.resize()}function ae(){h()===!0&&g()===!0&&(b(),ie(),oe())}i=i||{};var se,pe,ue,fe,le,ce,de,he,ve,ge,me="1.7.0",be="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",we=s(be),ye={alpha:"alpha-d2270",black:"black-3c85d",board:"board-b72b1",chessboard:"chessboard-63f37",clearfix:"clearfix-7da63",highlight1:"highlight1-32417",highlight2:"highlight2-9c5d2",notation:"notation-322f9",numeric:"numeric-fc462",piece:"piece-417db",row:"row-5277c",sparePieces:"spare-pieces-7492f",sparePiecesBottom:"spare-pieces-bottom-ae20f",sparePiecesTop:"spare-pieces-top-4028b",square:"square-55d63",white:"white-1e1d7"},Ee={},Pe=!1,Se=2,Oe="white",$e={},Ce=!1,_e={},Te={};return Ee.clear=function(e){Ee.position({},e)},Ee.destroy=function(){se.html(""),ue.remove(),se.unbind()},Ee.fen=function(){return Ee.position("fen")},Ee.flip=function(){Ee.orientation("flip")},Ee.move=function(){if(0!==arguments.length){for(var t=!0,n={},r=0;r<arguments.length;r++)if(arguments[r]!==!1)if(e(arguments[r])===!0){var o=arguments[r].split("-");n[o[0]]=o[1]}else d(2826,"Invalid move passed to the move method.",arguments[r]);else t=!1;var i=D($e,n);return Ee.position(i,t),i}},Ee.orientation=function(e){return 0===arguments.length?Oe:"white"===e||"black"===e?(Oe=e,void q()):"flip"===e?(Oe="white"===Oe?"black":"white",void q()):void d(5482,"Invalid value passed to the orientation method.",e)},Ee.position=function(e,t){return 0===arguments.length?f($e):"string"==typeof e&&"fen"===e.toLowerCase()?p($e):(t!==!1&&(t=!0),"string"==typeof e&&"start"===e.toLowerCase()&&(e=f(we)),r(e)===!0&&(e=s(e)),o(e)!==!0?void d(6482,"Invalid value passed to the position method.",e):void(t===!0?(_(x($e,e),$e,e),L(e)):(L(e),I())))},Ee.resize=function(){ce=m(),pe.css("width",8*ce+"px"),ue.css({height:ce,width:ce}),i.sparePieces===!0&&se.find("."+ye.sparePieces).css("paddingLeft",ce+Se+"px"),q()},Ee.start=function(e){Ee.position("start",e)},ae(),Ee},window.ChessBoard.fenToObj=s,window.ChessBoard.objToFen=p}(),angular.module("op").factory("Logic",["$rootScope","$http","$compile",function(e,t,n){function r(t,r,o,i,a,s){var p=$("<img/>").attr({src:"img/chesspieces/wikipedia/"+t+r+".png",height:"100%",width:"100%","ng-click":'Logic.move("'+a+'")',"tooltip-placement":"top",tooltip:i,"tooltip-animation":"false","tooltip-append-to-body":"true"}).addClass("move-alternative").addClass(a.replace("+",""));s&&p.addClass("castle"),p=n($(p))(e.$$childHead),
p.appendTo($(".square-"+o))}function o(){$(".move-alternative").remove(),$(".tooltip").remove();var e=u.opening(!0);e&&angular.forEach(e,function(t,n){if("name"!=n&&"eco"!=n){var o=a.turn(),i=e[n].name,s="",p="",u=n;if(u=u.replace("+",""),"O-O"==u)p="w"==o?"g1":"g8",s="K",r(o,s,p,i,n,!0),p="w"==o?"f1":"f8",s="R",r(o,s,p,i,n,!0);else if("O-O-O"==u)p="w"==o?"c1":"c8",s="K",r(o,s,p,i,n,!0),p="w"==o?"d1":"d8",s="R",r(o,s,p,i,n,!0);else{switch(u.length){case 2:s="P",p=u[0]+u[1];break;case 3:s=u[0],p=u[1]+u[2];break;case 4:s=u[0],s==s.toLowerCase()&&(s="P"),p=u[2]+u[3]}r(o,s,p,i,n,!1)}}})}var i;t.get("openings.json").success(function(e){i=e,o()});var a=new Chess,s={position:"start",draggable:!0,onDragStart:function(e,t,n,r){if(a.game_over()===!0||"w"===a.turn()&&t.search(/^b/)!==-1||"b"===a.turn()&&t.search(/^w/)!==-1)return!1},onDrop:function(t,n){var r=u.move({from:t,to:n,promotion:"q"});return null===r?"snapback":void e.$digest()}},p=new ChessBoard("board",s),u={move:function(e){var t=a.move(e);return null!=t&&p.position(a.fen()),o(),t},reset:function(){a.reset(),p.position("start"),o()},undo:function(){a.undo(),p.position(a.fen()),o()},fen:function(){return a.fen()},pgn:function(){return a.pgn()},getOpening:function(e,t){var n=i;if(!e)return n;for(var r=e.length,o=0;o<r;o++){if(!n[e[o]]){if(t)return null;break}n=n[e[o]]}return n},opening:function(e){var t=this.getOpening(a.history(),e);return t&&t.name&&(this.last_opening={name:t.name,eco:t.eco}),t},resizeBoard:function(){p.resize(),o()},flipBoard:function(){p.flip(),o()}};return u}]),angular.module("ui.bootstrap",["ui.bootstrap.tpls","ui.bootstrap.dropdownToggle","ui.bootstrap.position","ui.bootstrap.bindHtml","ui.bootstrap.tooltip"]),angular.module("ui.bootstrap.tpls",["template/tooltip/tooltip-html-unsafe-popup.html","template/tooltip/tooltip-popup.html"]),angular.module("ui.bootstrap.dropdownToggle",[]).directive("dropdownToggle",["$document","$location",function(e,t){var n=null,r=angular.noop;return{restrict:"CA",link:function(t,o,i){t.$watch("$location.path",function(){r()}),o.parent().bind("click",function(){r()}),o.bind("click",function(t){var i=o===n;t.preventDefault(),t.stopPropagation(),n&&r(),i||o.hasClass("disabled")||o.prop("disabled")||(o.parent().addClass("open"),n=o,r=function(t){t&&(t.preventDefault(),t.stopPropagation()),e.unbind("click",r),o.parent().removeClass("open"),r=angular.noop,n=null},e.bind("click",r))})}}}]),angular.module("ui.bootstrap.position",[]).factory("$position",["$document","$window",function(e,t){function n(e,n){return e.currentStyle?e.currentStyle[n]:t.getComputedStyle?t.getComputedStyle(e)[n]:e.style[n]}function r(e){return"static"===(n(e,"position")||"static")}var o=function(t){for(var n=e[0],o=t.offsetParent||n;o&&o!==n&&r(o);)o=o.offsetParent;return o||n};return{position:function(t){var n=this.offset(t),r={top:0,left:0},i=o(t[0]);i!=e[0]&&(r=this.offset(angular.element(i)),r.top+=i.clientTop-i.scrollTop,r.left+=i.clientLeft-i.scrollLeft);var a=t[0].getBoundingClientRect();return{width:a.width||t.prop("offsetWidth"),height:a.height||t.prop("offsetHeight"),top:n.top-r.top,left:n.left-r.left}},offset:function(n){var r=n[0].getBoundingClientRect();return{width:r.width||n.prop("offsetWidth"),height:r.height||n.prop("offsetHeight"),top:r.top+(t.pageYOffset||e[0].body.scrollTop||e[0].documentElement.scrollTop),left:r.left+(t.pageXOffset||e[0].body.scrollLeft||e[0].documentElement.scrollLeft)}}}}]),angular.module("ui.bootstrap.bindHtml",[]).directive("bindHtmlUnsafe",function(){return function(e,t,n){t.addClass("ng-binding").data("$binding",n.bindHtmlUnsafe),e.$watch(n.bindHtmlUnsafe,function(e){t.html(e||"")})}}),angular.module("ui.bootstrap.tooltip",["ui.bootstrap.position","ui.bootstrap.bindHtml"]).provider("$tooltip",function(){function e(e){var t=/[A-Z]/g,n="-";return e.replace(t,function(e,t){return(t?n:"")+e.toLowerCase()})}var t={placement:"top",animation:!0,popupDelay:0},n={mouseenter:"mouseleave",click:"click",focus:"blur"},r={};this.options=function(e){angular.extend(r,e)},this.setTriggers=function(e){angular.extend(n,e)},this.$get=["$window","$compile","$timeout","$parse","$document","$position","$interpolate",function(o,i,a,s,p,u,f){return function(o,l,c){function d(e){var t=e||h.trigger||c,r=n[t]||t;return{show:t,hide:r}}var h=angular.extend({},t,r),v=e(o),g=f.startSymbol(),m=f.endSymbol(),b="<div "+v+'-popup title="'+g+"tt_title"+m+'" content="'+g+"tt_content"+m+'" placement="'+g+"tt_placement"+m+'" animation="tt_animation" is-open="tt_isOpen"></div>';return{restrict:"EA",scope:!0,compile:function(e,t){var n=i(b);return function(e,t,r){function i(){e.tt_isOpen?c():f()}function f(){$&&!e.$eval(r[l+"Enable"])||(e.tt_popupDelay?(E=a(v,e.tt_popupDelay,!1),E.then(function(e){e()})):v()())}function c(){e.$apply(function(){g()})}function v(){return e.tt_content?(m(),y&&a.cancel(y),w.css({top:0,left:0,display:"block"}),P?p.find("body").append(w):t.after(w),C(),e.tt_isOpen=!0,e.$digest(),C):angular.noop}function g(){e.tt_isOpen=!1,a.cancel(E),e.tt_animation?y=a(b,500):b()}function m(){w&&b(),w=n(e,function(){}),e.$digest()}function b(){w&&(w.remove(),w=null)}var w,y,E,P=!!angular.isDefined(h.appendToBody)&&h.appendToBody,S=d(void 0),O=!1,$=angular.isDefined(r[l+"Enable"]),C=function(){var n,r,o,i;switch(n=P?u.offset(t):u.position(t),r=w.prop("offsetWidth"),o=w.prop("offsetHeight"),e.tt_placement){case"right":i={top:n.top+n.height/2-o/2,left:n.left+n.width};break;case"bottom":i={top:n.top+n.height,left:n.left+n.width/2-r/2};break;case"left":i={top:n.top+n.height/2-o/2,left:n.left-r};break;default:i={top:n.top-o,left:n.left+n.width/2-r/2}}i.top+="px",i.left+="px",w.css(i)};e.tt_isOpen=!1,r.$observe(o,function(t){e.tt_content=t,!t&&e.tt_isOpen&&g()}),r.$observe(l+"Title",function(t){e.tt_title=t}),r.$observe(l+"Placement",function(t){e.tt_placement=angular.isDefined(t)?t:h.placement}),r.$observe(l+"PopupDelay",function(t){var n=parseInt(t,10);e.tt_popupDelay=isNaN(n)?h.popupDelay:n});var _=function(){O&&(t.unbind(S.show,f),t.unbind(S.hide,c))};r.$observe(l+"Trigger",function(e){_(),S=d(e),S.show===S.hide?t.bind(S.show,i):(t.bind(S.show,f),t.bind(S.hide,c)),O=!0});var T=e.$eval(r[l+"Animation"]);e.tt_animation=angular.isDefined(T)?!!T:h.animation,r.$observe(l+"AppendToBody",function(t){P=angular.isDefined(t)?s(t)(e):P}),P&&e.$on("$locationChangeSuccess",function(){e.tt_isOpen&&g()}),e.$on("$destroy",function(){a.cancel(y),a.cancel(E),_(),b()})}}}}}]}).directive("tooltipPopup",function(){return{restrict:"EA",replace:!0,scope:{content:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"template/tooltip/tooltip-popup.html"}}).directive("tooltip",["$tooltip",function(e){return e("tooltip","tooltip","mouseenter")}]).directive("tooltipHtmlUnsafePopup",function(){return{restrict:"EA",replace:!0,scope:{content:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"template/tooltip/tooltip-html-unsafe-popup.html"}}).directive("tooltipHtmlUnsafe",["$tooltip",function(e){return e("tooltipHtmlUnsafe","tooltip","mouseenter")}]),angular.module("template/tooltip/tooltip-html-unsafe-popup.html",[]).run(["$templateCache",function(e){e.put("template/tooltip/tooltip-html-unsafe-popup.html",'<div class="tooltip {{placement}}" ng-class="{ in: isOpen(), fade: animation() }">\n  <div class="tooltip-arrow"></div>\n  <div class="tooltip-inner" bind-html-unsafe="content"></div>\n</div>\n')}]),angular.module("template/tooltip/tooltip-popup.html",[]).run(["$templateCache",function(e){e.put("template/tooltip/tooltip-popup.html",'<div class="tooltip {{placement}}" ng-class="{ in: isOpen(), fade: animation() }">\n  <div class="tooltip-arrow"></div>\n  <div class="tooltip-inner" ng-bind="content"></div>\n</div>\n')}]);